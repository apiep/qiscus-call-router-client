(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.QiscusCallRouter=e()}})(function(){var k,e,t;return function(){function p(o,a,s){function c(r,e){if(!a[r]){if(!o[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(f)return f(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=a[r]={exports:{}};o[r][0].call(i.exports,function(e){var t=o[r][1][e];return c(t||e)},i,i.exports,p,o,a,s)}return a[r].exports}for(var f="function"==typeof require&&require,e=0;e<s.length;e++)c(s[e]);return c}return p}()({1:[function(e,t,r){t.exports=n;function n(e,r,n){var i=false;n=n||a;o.count=e;return e===0?r():o;function o(e,t){if(o.count<=0){throw new Error("after called too many times")}--o.count;if(e){i=true;r(e);r=n}else if(o.count===0&&!i){r(null,t)}}}function a(){}},{}],2:[function(e,t,r){t.exports=function(e,t,r){var n=e.byteLength;t=t||0;r=r||n;if(e.slice){return e.slice(t,r)}if(t<0){t+=n}if(r<0){r+=n}if(r>n){r=n}if(t>=n||t>=r||n===0){return new ArrayBuffer(0)}var i=new Uint8Array(e);var o=new Uint8Array(r-t);for(var a=t,s=0;a<r;a++,s++){o[s]=i[a]}return o.buffer}},{}],3:[function(e,t,r){t.exports=n;function n(e){e=e||{};this.ms=e.min||100;this.max=e.max||1e4;this.factor=e.factor||2;this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0;this.attempts=0}n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random();var r=Math.floor(t*this.jitter*e);e=(Math.floor(t*10)&1)==0?e-r:e+r}return Math.min(e,this.max)|0};n.prototype.reset=function(){this.attempts=0};n.prototype.setMin=function(e){this.ms=e};n.prototype.setMax=function(e){this.max=e};n.prototype.setJitter=function(e){this.jitter=e}},{}],4:[function(e,t,r){(function(){"use strict";var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var u=new Uint8Array(256);for(var e=0;e<o.length;e++){u[o.charCodeAt(e)]=e}r.encode=function(e){var t=new Uint8Array(e),r,n=t.length,i="";for(r=0;r<n;r+=3){i+=o[t[r]>>2];i+=o[(t[r]&3)<<4|t[r+1]>>4];i+=o[(t[r+1]&15)<<2|t[r+2]>>6];i+=o[t[r+2]&63]}if(n%3===2){i=i.substring(0,i.length-1)+"="}else if(n%3===1){i=i.substring(0,i.length-2)+"=="}return i};r.decode=function(e){var t=e.length*.75,r=e.length,n,i=0,o,a,s,c;if(e[e.length-1]==="="){t--;if(e[e.length-2]==="="){t--}}var f=new ArrayBuffer(t),p=new Uint8Array(f);for(n=0;n<r;n+=4){o=u[e.charCodeAt(n)];a=u[e.charCodeAt(n+1)];s=u[e.charCodeAt(n+2)];c=u[e.charCodeAt(n+3)];p[i++]=o<<2|a>>4;p[i++]=(a&15)<<4|s>>2;p[i++]=(s&3)<<6|c&63}return f}})()},{}],5:[function(e,c,t){(function(e){var i=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder;var t=function(){try{var e=new Blob(["hi"]);return e.size===2}catch(e){return false}}();var r=t&&function(){try{var e=new Blob([new Uint8Array([1,2])]);return e.size===2}catch(e){return false}}();var n=i&&i.prototype.append&&i.prototype.getBlob;function o(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.buffer instanceof ArrayBuffer){var n=r.buffer;if(r.byteLength!==n.byteLength){var i=new Uint8Array(r.byteLength);i.set(new Uint8Array(n,r.byteOffset,r.byteLength));n=i.buffer}e[t]=n}}}function a(e,t){t=t||{};var r=new i;o(e);for(var n=0;n<e.length;n++){r.append(e[n])}return t.type?r.getBlob(t.type):r.getBlob()}function s(e,t){o(e);return new Blob(e,t||{})}c.exports=function(){if(t){return r?e.Blob:s}else if(n){return a}else{return undefined}}()}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],6:[function(e,t,r){},{}],7:[function(e,t,r){var n=[].slice;t.exports=function(e,t){if("string"==typeof t)t=e[t];if("function"!=typeof t)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return t.apply(e,r.concat(n.call(arguments)))}}},{}],8:[function(e,t,r){if(typeof t!=="undefined"){t.exports=n}function n(e){if(e)return i(e)}function i(e){for(var t in n.prototype){e[t]=n.prototype[t]}return e}n.prototype.on=n.prototype.addEventListener=function(e,t){this._callbacks=this._callbacks||{};(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t);return this};n.prototype.once=function(e,t){function r(){this.off(e,r);t.apply(this,arguments)}r.fn=t;this.on(e,r);return this};n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length){delete this._callbacks["$"+e];return this}var n;for(var i=0;i<r.length;i++){n=r[i];if(n===t||n.fn===t){r.splice(i,1);break}}return this};n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n){r[n].apply(this,t)}}return this};n.prototype.listeners=function(e){this._callbacks=this._callbacks||{};return this._callbacks["$"+e]||[]};n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],9:[function(e,t,r){t.exports=function(e,t){var r=function(){};r.prototype=t.prototype;e.prototype=new r;e.prototype.constructor=e}},{}],10:[function(e,t,r){t.exports=e("./socket");t.exports.parser=e("engine.io-parser")},{"./socket":11,"engine.io-parser":21}],11:[function(t,r,e){(function(n){var i=t("./transports/index");var e=t("component-emitter");var u=t("debug")("engine.io-client:socket");var o=t("indexof");var a=t("engine.io-parser");var s=t("parseuri");var c=t("parseqs");r.exports=d;function d(e,t){if(!(this instanceof d))return new d(e,t);t=t||{};if(e&&"object"===typeof e){t=e;e=null}if(e){e=s(e);t.hostname=e.host;t.secure=e.protocol==="https"||e.protocol==="wss";t.port=e.port;if(e.query)t.query=e.query}else if(t.host){t.hostname=s(t.host).host}this.secure=null!=t.secure?t.secure:n.location&&"https:"===location.protocol;if(t.hostname&&!t.port){t.port=this.secure?"443":"80"}this.agent=t.agent||false;this.hostname=t.hostname||(n.location?location.hostname:"localhost");this.port=t.port||(n.location&&location.port?location.port:this.secure?443:80);this.query=t.query||{};if("string"===typeof this.query)this.query=c.decode(this.query);this.upgrade=false!==t.upgrade;this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!t.forceJSONP;this.jsonp=false!==t.jsonp;this.forceBase64=!!t.forceBase64;this.enablesXDR=!!t.enablesXDR;this.timestampParam=t.timestampParam||"t";this.timestampRequests=t.timestampRequests;this.transports=t.transports||["polling","websocket"];this.transportOptions=t.transportOptions||{};this.readyState="";this.writeBuffer=[];this.prevBufferLen=0;this.policyPort=t.policyPort||843;this.rememberUpgrade=t.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=t.onlyBinaryUpgrades;this.perMessageDeflate=false!==t.perMessageDeflate?t.perMessageDeflate||{}:false;if(true===this.perMessageDeflate)this.perMessageDeflate={};if(this.perMessageDeflate&&null==this.perMessageDeflate.threshold){this.perMessageDeflate.threshold=1024}this.pfx=t.pfx||null;this.key=t.key||null;this.passphrase=t.passphrase||null;this.cert=t.cert||null;this.ca=t.ca||null;this.ciphers=t.ciphers||null;this.rejectUnauthorized=t.rejectUnauthorized===undefined?true:t.rejectUnauthorized;this.forceNode=!!t.forceNode;var r=typeof n==="object"&&n;if(r.global===r){if(t.extraHeaders&&Object.keys(t.extraHeaders).length>0){this.extraHeaders=t.extraHeaders}if(t.localAddress){this.localAddress=t.localAddress}}this.id=null;this.upgrades=null;this.pingInterval=null;this.pingTimeout=null;this.pingIntervalTimer=null;this.pingTimeoutTimer=null;this.open()}d.priorWebsocketSuccess=false;e(d.prototype);d.protocol=a.protocol;d.Socket=d;d.Transport=t("./transport");d.transports=t("./transports/index");d.parser=t("engine.io-parser");d.prototype.createTransport=function(e){u('creating transport "%s"',e);var t=f(this.query);t.EIO=a.protocol;t.transport=e;var r=this.transportOptions[e]||{};if(this.id)t.sid=this.id;var n=new i[e]({query:t,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0});return n};function f(e){var t={};for(var r in e){if(e.hasOwnProperty(r)){t[r]=e[r]}}return t}d.prototype.open=function(){var e;if(this.rememberUpgrade&&d.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1){e="websocket"}else if(0===this.transports.length){var t=this;setTimeout(function(){t.emit("error","No transports available")},0);return}else{e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){this.transports.shift();this.open();return}e.open();this.setTransport(e)};d.prototype.setTransport=function(e){u("setting transport %s",e.name);var t=this;if(this.transport){u("clearing existing transport %s",this.transport.name);this.transport.removeAllListeners()}this.transport=e;e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})};d.prototype.probe=function(r){u('probing transport "%s"',r);var n=this.createTransport(r,{probe:1});var i=false;var o=this;d.priorWebsocketSuccess=false;function e(){if(o.onlyBinaryUpgrades){var e=!this.supportsBinary&&o.transport.supportsBinary;i=i||e}if(i)return;u('probe transport "%s" opened',r);n.send([{type:"ping",data:"probe"}]);n.once("packet",function(e){if(i)return;if("pong"===e.type&&"probe"===e.data){u('probe transport "%s" pong',r);o.upgrading=true;o.emit("upgrading",n);if(!n)return;d.priorWebsocketSuccess="websocket"===n.name;u('pausing current transport "%s"',o.transport.name);o.transport.pause(function(){if(i)return;if("closed"===o.readyState)return;u("changing transport and sending upgrade packet");p();o.setTransport(n);n.send([{type:"upgrade"}]);o.emit("upgrade",n);n=null;o.upgrading=false;o.flush()})}else{u('probe transport "%s" failed',r);var t=new Error("probe error");t.transport=n.name;o.emit("upgradeError",t)}})}function a(){if(i)return;i=true;p();n.close();n=null}function t(e){var t=new Error("probe error: "+e);t.transport=n.name;a();u('probe transport "%s" failed because of error: %s',r,e);o.emit("upgradeError",t)}function s(){t("transport closed")}function c(){t("socket closed")}function f(e){if(n&&e.name!==n.name){u('"%s" works - aborting "%s"',e.name,n.name);a()}}function p(){n.removeListener("open",e);n.removeListener("error",t);n.removeListener("close",s);o.removeListener("close",c);o.removeListener("upgrading",f)}n.once("open",e);n.once("error",t);n.once("close",s);this.once("close",c);this.once("upgrading",f);n.open()};d.prototype.onOpen=function(){u("socket open");this.readyState="open";d.priorWebsocketSuccess="websocket"===this.transport.name;this.emit("open");this.flush();if("open"===this.readyState&&this.upgrade&&this.transport.pause){u("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++){this.probe(this.upgrades[e])}}};d.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){u('socket receive: type "%s", data "%s"',e.type,e.data);this.emit("packet",e);this.emit("heartbeat");switch(e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing();this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data;this.onError(t);break;case"message":this.emit("data",e.data);this.emit("message",e.data);break}}else{u('packet received with socket readyState "%s"',this.readyState)}};d.prototype.onHandshake=function(e){this.emit("handshake",e);this.id=e.sid;this.transport.query.sid=e.sid;this.upgrades=this.filterUpgrades(e.upgrades);this.pingInterval=e.pingInterval;this.pingTimeout=e.pingTimeout;this.onOpen();if("closed"===this.readyState)return;this.setPing();this.removeListener("heartbeat",this.onHeartbeat);this.on("heartbeat",this.onHeartbeat)};d.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){if("closed"===t.readyState)return;t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)};d.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer);e.pingIntervalTimer=setTimeout(function(){u("writing ping packet - expecting pong within %sms",e.pingTimeout);e.ping();e.onHeartbeat(e.pingTimeout)},e.pingInterval)};d.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})};d.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emit("drain")}else{this.flush()}};d.prototype.flush=function(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){u("flushing %d packets in socket",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit("flush")}};d.prototype.write=d.prototype.send=function(e,t,r){this.sendPacket("message",e,t,r);return this};d.prototype.sendPacket=function(e,t,r,n){if("function"===typeof t){n=t;t=undefined}if("function"===typeof r){n=r;r=null}if("closing"===this.readyState||"closed"===this.readyState){return}r=r||{};r.compress=false!==r.compress;var i={type:e,data:t,options:r};this.emit("packetCreate",i);this.writeBuffer.push(i);if(n)this.once("flush",n);this.flush()};d.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;if(this.writeBuffer.length){this.once("drain",function(){if(this.upgrading){n()}else{t()}})}else if(this.upgrading){n()}else{t()}}function t(){e.onClose("forced close");u("socket closing - telling transport to close");e.transport.close()}function r(){e.removeListener("upgrade",r);e.removeListener("upgradeError",r);t()}function n(){e.once("upgrade",r);e.once("upgradeError",r)}return this};d.prototype.onError=function(e){u("socket error %j",e);d.priorWebsocketSuccess=false;this.emit("error",e);this.onClose("transport error",e)};d.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){u('socket close with reason: "%s"',e);var r=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",e,t);r.writeBuffer=[];r.prevBufferLen=0}};d.prototype.filterUpgrades=function(e){var t=[];for(var r=0,n=e.length;r<n;r++){if(~o(this.transports,e[r]))t.push(e[r])}return t}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./transport":12,"./transports/index":13,"component-emitter":8,debug:19,"engine.io-parser":21,indexof:27,parseqs:29,parseuri:30}],12:[function(e,t,r){var n=e("engine.io-parser");var i=e("component-emitter");t.exports=o;function o(e){this.path=e.path;this.hostname=e.hostname;this.port=e.port;this.secure=e.secure;this.query=e.query;this.timestampParam=e.timestampParam;this.timestampRequests=e.timestampRequests;this.readyState="";this.agent=e.agent||false;this.socket=e.socket;this.enablesXDR=e.enablesXDR;this.pfx=e.pfx;this.key=e.key;this.passphrase=e.passphrase;this.cert=e.cert;this.ca=e.ca;this.ciphers=e.ciphers;this.rejectUnauthorized=e.rejectUnauthorized;this.forceNode=e.forceNode;this.extraHeaders=e.extraHeaders;this.localAddress=e.localAddress}i(o.prototype);o.prototype.onError=function(e,t){var r=new Error(e);r.type="TransportError";r.description=t;this.emit("error",r);return this};o.prototype.open=function(){if("closed"===this.readyState||""===this.readyState){this.readyState="opening";this.doOpen()}return this};o.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.doClose();this.onClose()}return this};o.prototype.send=function(e){if("open"===this.readyState){this.write(e)}else{throw new Error("Transport not open")}};o.prototype.onOpen=function(){this.readyState="open";this.writable=true;this.emit("open")};o.prototype.onData=function(e){var t=n.decodePacket(e,this.socket.binaryType);this.onPacket(t)};o.prototype.onPacket=function(e){this.emit("packet",e)};o.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":8,"engine.io-parser":21}],13:[function(r,e,n){(function(s){var c=r("xmlhttprequest-ssl");var f=r("./polling-xhr");var p=r("./polling-jsonp");var e=r("./websocket");n.polling=t;n.websocket=e;function t(e){var t;var r=false;var n=false;var i=false!==e.jsonp;if(s.location){var o="https:"===location.protocol;var a=location.port;if(!a){a=o?443:80}r=e.hostname!==location.hostname||a!==e.port;n=e.secure!==o}e.xdomain=r;e.xscheme=n;t=new c(e);if("open"in t&&!e.forceJSONP){return new f(e)}else{if(!i)throw new Error("JSONP disabled");return new p(e)}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling-jsonp":14,"./polling-xhr":15,"./websocket":17,"xmlhttprequest-ssl":18}],14:[function(a,s,e){(function(r){var n=a("./polling");var e=a("component-inherit");s.exports=t;var f=/\n/g;var p=/\\n/g;var i;function o(){}function t(e){n.call(this,e);this.query=this.query||{};if(!i){if(!r.___eio)r.___eio=[];i=r.___eio}this.index=i.length;var t=this;i.push(function(e){t.onData(e)});this.query.j=this.index;if(r.document&&r.addEventListener){r.addEventListener("beforeunload",function(){if(t.script)t.script.onerror=o},false)}}e(t,n);t.prototype.supportsBinary=false;t.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}n.prototype.doClose.call(this)};t.prototype.doPoll=function(){var t=this;var e=document.createElement("script");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}e.async=true;e.src=this.uri();e.onerror=function(e){t.onError("jsonp poll error",e)};var r=document.getElementsByTagName("script")[0];if(r){r.parentNode.insertBefore(e,r)}else{(document.head||document.body).appendChild(e)}this.script=e;var n="undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent);if(n){setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e);document.body.removeChild(e)},100)}};t.prototype.doWrite=function(e,t){var r=this;if(!this.form){var n=document.createElement("form");var i=document.createElement("textarea");var o=this.iframeId="eio_iframe_"+this.index;var a;n.className="socketio";n.style.position="absolute";n.style.top="-1000px";n.style.left="-1000px";n.target=o;n.method="POST";n.setAttribute("accept-charset","utf-8");i.name="d";n.appendChild(i);document.body.appendChild(n);this.form=n;this.area=i}this.form.action=this.uri();function s(){c();t()}function c(){if(r.iframe){try{r.form.removeChild(r.iframe)}catch(e){r.onError("jsonp polling iframe removal error",e)}}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';a=document.createElement(e)}catch(e){a=document.createElement("iframe");a.name=r.iframeId;a.src="javascript:0"}a.id=r.iframeId;r.form.appendChild(a);r.iframe=a}c();e=e.replace(p,"\\\n");this.area.value=e.replace(f,"\\n");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(r.iframe.readyState==="complete"){s()}}}else{this.iframe.onload=s}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":16,"component-inherit":9}],15:[function(p,u,e){(function(i){var o=p("xmlhttprequest-ssl");var n=p("./polling");var e=p("component-emitter");var t=p("component-inherit");var a=p("debug")("engine.io-client:polling-xhr");u.exports=s;u.exports.Request=c;function r(){}function s(e){n.call(this,e);this.requestTimeout=e.requestTimeout;this.extraHeaders=e.extraHeaders;if(i.location){var t="https:"===location.protocol;var r=location.port;if(!r){r=t?443:80}this.xd=e.hostname!==i.location.hostname||r!==e.port;this.xs=e.secure!==t}}t(s,n);s.prototype.supportsBinary=true;s.prototype.request=function(e){e=e||{};e.uri=this.uri();e.xd=this.xd;e.xs=this.xs;e.agent=this.agent||false;e.supportsBinary=this.supportsBinary;e.enablesXDR=this.enablesXDR;e.pfx=this.pfx;e.key=this.key;e.passphrase=this.passphrase;e.cert=this.cert;e.ca=this.ca;e.ciphers=this.ciphers;e.rejectUnauthorized=this.rejectUnauthorized;e.requestTimeout=this.requestTimeout;e.extraHeaders=this.extraHeaders;return new c(e)};s.prototype.doWrite=function(e,t){var r=typeof e!=="string"&&e!==undefined;var n=this.request({method:"POST",data:e,isBinary:r});var i=this;n.on("success",t);n.on("error",function(e){i.onError("xhr post error",e)});this.sendXhr=n};s.prototype.doPoll=function(){a("xhr poll");var e=this.request();var t=this;e.on("data",function(e){t.onData(e)});e.on("error",function(e){t.onError("xhr poll error",e)});this.pollXhr=e};function c(e){this.method=e.method||"GET";this.uri=e.uri;this.xd=!!e.xd;this.xs=!!e.xs;this.async=false!==e.async;this.data=undefined!==e.data?e.data:null;this.agent=e.agent;this.isBinary=e.isBinary;this.supportsBinary=e.supportsBinary;this.enablesXDR=e.enablesXDR;this.requestTimeout=e.requestTimeout;this.pfx=e.pfx;this.key=e.key;this.passphrase=e.passphrase;this.cert=e.cert;this.ca=e.ca;this.ciphers=e.ciphers;this.rejectUnauthorized=e.rejectUnauthorized;this.extraHeaders=e.extraHeaders;this.create()}e(c.prototype);c.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx;e.key=this.key;e.passphrase=this.passphrase;e.cert=this.cert;e.ca=this.ca;e.ciphers=this.ciphers;e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new o(e);var r=this;try{a("xhr open %s: %s",this.method,this.uri);t.open(this.method,this.uri,this.async);try{if(this.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(true);for(var n in this.extraHeaders){if(this.extraHeaders.hasOwnProperty(n)){t.setRequestHeader(n,this.extraHeaders[n])}}}}catch(e){}if("POST"===this.method){try{if(this.isBinary){t.setRequestHeader("Content-type","application/octet-stream")}else{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}}catch(e){}}try{t.setRequestHeader("Accept","*/*")}catch(e){}if("withCredentials"in t){t.withCredentials=true}if(this.requestTimeout){t.timeout=this.requestTimeout}if(this.hasXDR()){t.onload=function(){r.onLoad()};t.onerror=function(){r.onError(t.responseText)}}else{t.onreadystatechange=function(){if(t.readyState===2){try{var e=t.getResponseHeader("Content-Type");if(r.supportsBinary&&e==="application/octet-stream"){t.responseType="arraybuffer"}}catch(e){}}if(4!==t.readyState)return;if(200===t.status||1223===t.status){r.onLoad()}else{setTimeout(function(){r.onError(t.status)},0)}}}a("xhr data %s",this.data);t.send(this.data)}catch(e){setTimeout(function(){r.onError(e)},0);return}if(i.document){this.index=c.requestsCount++;c.requests[this.index]=this}};c.prototype.onSuccess=function(){this.emit("success");this.cleanup()};c.prototype.onData=function(e){this.emit("data",e);this.onSuccess()};c.prototype.onError=function(e){this.emit("error",e);this.cleanup(true)};c.prototype.cleanup=function(e){if("undefined"===typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=r}else{this.xhr.onreadystatechange=r}if(e){try{this.xhr.abort()}catch(e){}}if(i.document){delete c.requests[this.index]}this.xhr=null};c.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}if(t==="application/octet-stream"){e=this.xhr.response||this.xhr.responseText}else{e=this.xhr.responseText}}catch(e){this.onError(e)}if(null!=e){this.onData(e)}};c.prototype.hasXDR=function(){return"undefined"!==typeof i.XDomainRequest&&!this.xs&&this.enablesXDR};c.prototype.abort=function(){this.cleanup()};c.requestsCount=0;c.requests={};if(i.document){if(i.attachEvent){i.attachEvent("onunload",f)}else if(i.addEventListener){i.addEventListener("beforeunload",f,false)}}function f(){for(var e in c.requests){if(c.requests.hasOwnProperty(e)){c.requests[e].abort()}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":16,"component-emitter":8,"component-inherit":9,debug:19,"xmlhttprequest-ssl":18}],16:[function(r,e,t){var n=r("../transport");var i=r("parseqs");var o=r("engine.io-parser");var a=r("component-inherit");var s=r("yeast");var c=r("debug")("engine.io-client:polling");e.exports=p;var f=function(){var e=r("xmlhttprequest-ssl");var t=new e({xdomain:false});return null!=t.responseType}();function p(e){var t=e&&e.forceBase64;if(!f||t){this.supportsBinary=false}n.call(this,e)}a(p,n);p.prototype.name="polling";p.prototype.doOpen=function(){this.poll()};p.prototype.pause=function(e){var t=this;this.readyState="pausing";function r(){c("paused");t.readyState="paused";e()}if(this.polling||!this.writable){var n=0;if(this.polling){c("we are currently polling - waiting to pause");n++;this.once("pollComplete",function(){c("pre-pause polling complete");--n||r()})}if(!this.writable){c("we are currently writing - waiting to pause");n++;this.once("drain",function(){c("pre-pause writing complete");--n||r()})}}else{r()}};p.prototype.poll=function(){c("polling");this.polling=true;this.doPoll();this.emit("poll")};p.prototype.onData=function(e){var n=this;c("polling got data %s",e);var t=function(e,t,r){if("opening"===n.readyState){n.onOpen()}if("close"===e.type){n.onClose();return false}n.onPacket(e)};o.decodePayload(e,this.socket.binaryType,t);if("closed"!==this.readyState){this.polling=false;this.emit("pollComplete");if("open"===this.readyState){this.poll()}else{c('ignoring poll - transport state "%s"',this.readyState)}}};p.prototype.doClose=function(){var e=this;function t(){c("writing close packet");e.write([{type:"close"}])}if("open"===this.readyState){c("transport open - closing");t()}else{c("transport not open - deferring close");this.once("open",t)}};p.prototype.write=function(e){var t=this;this.writable=false;var r=function(){t.writable=true;t.emit("drain")};o.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,r)})};p.prototype.uri=function(){var e=this.query||{};var t=this.secure?"https":"http";var r="";if(false!==this.timestampRequests){e[this.timestampParam]=s()}if(!this.supportsBinary&&!e.sid){e.b64=1}e=i.encode(e);if(this.port&&("https"===t&&Number(this.port)!==443||"http"===t&&Number(this.port)!==80)){r=":"+this.port}if(e.length){e="?"+e}var n=this.hostname.indexOf(":")!==-1;return t+"://"+(n?"["+this.hostname+"]":this.hostname)+r+this.path+e}},{"../transport":12,"component-inherit":9,debug:19,"engine.io-parser":21,parseqs:29,"xmlhttprequest-ssl":18,yeast:59}],17:[function(u,d,e){(function(s){var r=u("../transport");var c=u("engine.io-parser");var i=u("parseqs");var e=u("component-inherit");var o=u("yeast");var f=u("debug")("engine.io-client:websocket");var n=s.WebSocket||s.MozWebSocket;var a;if(typeof window==="undefined"){try{a=u("ws")}catch(e){}}var p=n;if(!p&&typeof window==="undefined"){p=a}d.exports=t;function t(e){var t=e&&e.forceBase64;if(t){this.supportsBinary=false}this.perMessageDeflate=e.perMessageDeflate;this.usingBrowserWebSocket=n&&!e.forceNode;this.protocols=e.protocols;if(!this.usingBrowserWebSocket){p=a}r.call(this,e)}e(t,r);t.prototype.name="websocket";t.prototype.supportsBinary=true;t.prototype.doOpen=function(){if(!this.check()){return}var e=this.uri();var t=this.protocols;var r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx;r.key=this.key;r.passphrase=this.passphrase;r.cert=this.cert;r.ca=this.ca;r.ciphers=this.ciphers;r.rejectUnauthorized=this.rejectUnauthorized;if(this.extraHeaders){r.headers=this.extraHeaders}if(this.localAddress){r.localAddress=this.localAddress}try{this.ws=this.usingBrowserWebSocket?t?new p(e,t):new p(e):new p(e,t,r)}catch(e){return this.emit("error",e)}if(this.ws.binaryType===undefined){this.supportsBinary=false}if(this.ws.supports&&this.ws.supports.binary){this.supportsBinary=true;this.ws.binaryType="nodebuffer"}else{this.ws.binaryType="arraybuffer"}this.addEventListeners()};t.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()};this.ws.onclose=function(){t.onClose()};this.ws.onmessage=function(e){t.onData(e.data)};this.ws.onerror=function(e){t.onError("websocket error",e)}};t.prototype.write=function(e){var i=this;this.writable=false;var o=e.length;for(var t=0,r=o;t<r;t++){(function(n){c.encodePacket(n,i.supportsBinary,function(e){if(!i.usingBrowserWebSocket){var t={};if(n.options){t.compress=n.options.compress}if(i.perMessageDeflate){var r="string"===typeof e?s.Buffer.byteLength(e):e.length;if(r<i.perMessageDeflate.threshold){t.compress=false}}}try{if(i.usingBrowserWebSocket){i.ws.send(e)}else{i.ws.send(e,t)}}catch(e){f("websocket closed before onclose event")}--o||a()})})(e[t])}function a(){i.emit("flush");setTimeout(function(){i.writable=true;i.emit("drain")},0)}};t.prototype.onClose=function(){r.prototype.onClose.call(this)};t.prototype.doClose=function(){if(typeof this.ws!=="undefined"){this.ws.close()}};t.prototype.uri=function(){var e=this.query||{};var t=this.secure?"wss":"ws";var r="";if(this.port&&("wss"===t&&Number(this.port)!==443||"ws"===t&&Number(this.port)!==80)){r=":"+this.port}if(this.timestampRequests){e[this.timestampParam]=o()}if(!this.supportsBinary){e.b64=1}e=i.encode(e);if(e.length){e="?"+e}var n=this.hostname.indexOf(":")!==-1;return t+"://"+(n?"["+this.hostname+"]":this.hostname)+r+this.path+e};t.prototype.check=function(){return!!p&&!("__initialize"in p&&this.name===t.prototype.name)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../transport":12,"component-inherit":9,debug:19,"engine.io-parser":21,parseqs:29,ws:6,yeast:59}],18:[function(e,t,r){(function(i){var o=e("has-cors");t.exports=function(e){var t=e.xdomain;var r=e.xscheme;var n=e.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!t||o)){return new XMLHttpRequest}}catch(e){}try{if("undefined"!==typeof XDomainRequest&&!r&&n){return new XDomainRequest}}catch(e){}if(!t){try{return new(i[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"has-cors":26}],19:[function(s,c,f){(function(t){f=c.exports=s("./debug");f.log=n;f.formatArgs=r;f.save=i;f.load=o;f.useColors=e;f.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:a();f.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){if(typeof window!=="undefined"&&window.process&&window.process.type==="renderer"){return true}if(typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)){return false}return typeof document!=="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!=="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}f.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};function r(e){var t=this.useColors;e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+f.humanize(this.diff);if(!t)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var n=0;var i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){if("%%"===e)return;n++;if("%c"===e){i=n}});e.splice(i,0,r)}function n(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function i(e){try{if(null==e){f.storage.removeItem("debug")}else{f.storage.debug=e}}catch(e){}}function o(){var e;try{e=f.storage.debug}catch(e){}if(!e&&typeof t!=="undefined"&&"env"in t){e=t.env.DEBUG}return e}f.enable(o());function a(){try{return window.localStorage}catch(e){}}}).call(this,s("_process"))},{"./debug":20,_process:31}],20:[function(e,t,f){f=t.exports=n.debug=n["default"]=n;f.coerce=c;f.disable=a;f.enable=o;f.enabled=s;f.humanize=e("ms");f.instances=[];f.names=[];f.skips=[];f.formatters={};function r(e){var t=0,r;for(r in e){t=(t<<5)-t+e.charCodeAt(r);t|=0}return f.colors[Math.abs(t)%f.colors.length]}function n(e){var s;function c(){if(!c.enabled)return;var i=c;var e=+new Date;var t=e-(s||e);i.diff=t;i.prev=s;i.curr=e;s=e;var o=new Array(arguments.length);for(var r=0;r<o.length;r++){o[r]=arguments[r]}o[0]=f.coerce(o[0]);if("string"!==typeof o[0]){o.unshift("%O")}var a=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(e,t){if(e==="%%")return e;a++;var r=f.formatters[t];if("function"===typeof r){var n=o[a];e=r.call(i,n);o.splice(a,1);a--}return e});f.formatArgs.call(i,o);var n=c.log||f.log||console.log.bind(console);n.apply(i,o)}c.namespace=e;c.enabled=f.enabled(e);c.useColors=f.useColors();c.color=r(e);c.destroy=i;if("function"===typeof f.init){f.init(c)}f.instances.push(c);return c}function i(){var e=f.instances.indexOf(this);if(e!==-1){f.instances.splice(e,1);return true}else{return false}}function o(e){f.save(e);f.names=[];f.skips=[];var t;var r=(typeof e==="string"?e:"").split(/[\s,]+/);var n=r.length;for(t=0;t<n;t++){if(!r[t])continue;e=r[t].replace(/\*/g,".*?");if(e[0]==="-"){f.skips.push(new RegExp("^"+e.substr(1)+"$"))}else{f.names.push(new RegExp("^"+e+"$"))}}for(t=0;t<f.instances.length;t++){var i=f.instances[t];i.enabled=f.enabled(i.namespace)}}function a(){f.enable("")}function s(e){if(e[e.length-1]==="*"){return true}var t,r;for(t=0,r=f.skips.length;t<r;t++){if(f.skips[t].test(e)){return false}}for(t=0,r=f.names.length;t<r;t++){if(f.names[t].test(e)){return true}}return false}function c(e){if(e instanceof Error)return e.stack||e.message;return e}},{ms:28}],21:[function(n,e,T){(function(f){var e=n("./keys");var a=n("has-binary2");var d=n("arraybuffer.slice");var s=n("after");var c=n("./utf8");var i;if(f&&f.ArrayBuffer){i=n("base64-arraybuffer")}var t=typeof navigator!=="undefined"&&/Android/i.test(navigator.userAgent);var r=typeof navigator!=="undefined"&&/PhantomJS/i.test(navigator.userAgent);var p=t||r;T.protocol=3;var u=T.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var l=e(u);var h={type:"error",data:"parser error"};var v=n("blob");T.encodePacket=function(e,t,r,n){if(typeof t==="function"){n=t;t=false}if(typeof r==="function"){n=r;r=null}var i=e.data===undefined?undefined:e.data.buffer||e.data;if(f.ArrayBuffer&&i instanceof ArrayBuffer){return y(e,t,n)}else if(v&&i instanceof f.Blob){return g(e,t,n)}if(i&&i.base64){return m(e,n)}var o=u[e.type];if(undefined!==e.data){o+=r?c.encode(String(e.data),{strict:false}):String(e.data)}return n(""+o)};function m(e,t){var r="b"+T.packets[e.type]+e.data.data;return t(r)}function y(e,t,r){if(!t){return T.encodeBase64Packet(e,r)}var n=e.data;var i=new Uint8Array(n);var o=new Uint8Array(1+n.byteLength);o[0]=u[e.type];for(var a=0;a<i.length;a++){o[a+1]=i[a]}return r(o.buffer)}function o(e,t,r){if(!t){return T.encodeBase64Packet(e,r)}var n=new FileReader;n.onload=function(){e.data=n.result;T.encodePacket(e,t,true,r)};return n.readAsArrayBuffer(e.data)}function g(e,t,r){if(!t){return T.encodeBase64Packet(e,r)}if(p){return o(e,t,r)}var n=new Uint8Array(1);n[0]=u[e.type];var i=new v([n.buffer,e.data]);return r(i)}T.encodeBase64Packet=function(t,r){var n="b"+T.packets[t.type];if(v&&t.data instanceof f.Blob){var i=new FileReader;i.onload=function(){var e=i.result.split(",")[1];r(n+e)};return i.readAsDataURL(t.data)}var o;try{o=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(e){var a=new Uint8Array(t.data);var s=new Array(a.length);for(var c=0;c<a.length;c++){s[c]=a[c]}o=String.fromCharCode.apply(null,s)}n+=f.btoa(o);return r(n)};T.decodePacket=function(e,t,r){if(e===undefined){return h}if(typeof e==="string"){if(e.charAt(0)==="b"){return T.decodeBase64Packet(e.substr(1),t)}if(r){e=C(e);if(e===false){return h}}var n=e.charAt(0);if(Number(n)!=n||!l[n]){return h}if(e.length>1){return{type:l[n],data:e.substring(1)}}else{return{type:l[n]}}}var i=new Uint8Array(e);var n=i[0];var o=d(e,1);if(v&&t==="blob"){o=new v([o])}return{type:l[n],data:o}};function C(e){try{e=c.decode(e,{strict:false})}catch(e){return false}return e}T.decodeBase64Packet=function(e,t){var r=l[e.charAt(0)];if(!i){return{type:r,data:{base64:true,data:e.substr(1)}}}var n=i.decode(e.substr(1));if(t==="blob"&&v){n=new v([n])}return{type:r,data:n}};T.encodePayload=function(e,r,n){if(typeof r==="function"){n=r;r=null}var i=a(e);if(r&&i){if(v&&!p){return T.encodePayloadAsBlob(e,n)}return T.encodePayloadAsArrayBuffer(e,n)}if(!e.length){return n("0:")}function o(e){return e.length+":"+e}function t(e,t){T.encodePacket(e,!i?false:r,false,function(e){t(null,o(e))})}b(e,t,function(e,t){return n(t.join(""))})};function b(e,t,r){var i=new Array(e.length);var n=s(e.length,r);var o=function(r,e,n){t(e,function(e,t){i[r]=t;n(e,i)})};for(var a=0;a<e.length;a++){o(a,e[a],n)}}T.decodePayload=function(e,t,r){if(typeof e!=="string"){return T.decodePayloadAsBinary(e,t,r)}if(typeof t==="function"){r=t;t=null}var n;if(e===""){return r(h,0,1)}var i="",o,a;for(var s=0,c=e.length;s<c;s++){var f=e.charAt(s);if(f!==":"){i+=f;continue}if(i===""||i!=(o=Number(i))){return r(h,0,1)}a=e.substr(s+1,o);if(i!=a.length){return r(h,0,1)}if(a.length){n=T.decodePacket(a,t,false);if(h.type===n.type&&h.data===n.data){return r(h,0,1)}var p=r(n,s+o,c);if(false===p)return}s+=o;i=""}if(i!==""){return r(h,0,1)}};T.encodePayloadAsArrayBuffer=function(e,n){if(!e.length){return n(new ArrayBuffer(0))}function t(e,t){T.encodePacket(e,true,true,function(e){return t(null,e)})}b(e,t,function(e,t){var r=t.reduce(function(e,t){var r;if(typeof t==="string"){r=t.length}else{r=t.byteLength}return e+r.toString().length+r+2},0);var a=new Uint8Array(r);var s=0;t.forEach(function(e){var t=typeof e==="string";var r=e;if(t){var n=new Uint8Array(e.length);for(var i=0;i<e.length;i++){n[i]=e.charCodeAt(i)}r=n.buffer}if(t){a[s++]=0}else{a[s++]=1}var o=r.byteLength.toString();for(var i=0;i<o.length;i++){a[s++]=parseInt(o[i])}a[s++]=255;var n=new Uint8Array(r);for(var i=0;i<n.length;i++){a[s++]=n[i]}});return n(a.buffer)})};T.encodePayloadAsBlob=function(e,r){function t(e,c){T.encodePacket(e,true,true,function(e){var t=new Uint8Array(1);t[0]=1;if(typeof e==="string"){var r=new Uint8Array(e.length);for(var n=0;n<e.length;n++){r[n]=e.charCodeAt(n)}e=r.buffer;t[0]=0}var i=e instanceof ArrayBuffer?e.byteLength:e.size;var o=i.toString();var a=new Uint8Array(o.length+1);for(var n=0;n<o.length;n++){a[n]=parseInt(o[n])}a[o.length]=255;if(v){var s=new v([t.buffer,a.buffer,e]);c(null,s)}})}b(e,t,function(e,t){return r(new v(t))})};T.decodePayloadAsBinary=function(e,r,n){if(typeof r==="function"){n=r;r=null}var t=e;var i=[];while(t.byteLength>0){var o=new Uint8Array(t);var a=o[0]===0;var s="";for(var c=1;;c++){if(o[c]===255)break;if(s.length>310){return n(h,0,1)}s+=o[c]}t=d(t,2+s.length);s=parseInt(s);var f=d(t,0,s);if(a){try{f=String.fromCharCode.apply(null,new Uint8Array(f))}catch(e){var p=new Uint8Array(f);f="";for(var c=0;c<p.length;c++){f+=String.fromCharCode(p[c])}}}i.push(f);t=d(t,s)}var u=i.length;i.forEach(function(e,t){n(T.decodePacket(e,r,true),t,u)})}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./keys":22,"./utf8":23,after:1,"arraybuffer.slice":2,"base64-arraybuffer":4,blob:5,"has-binary2":24}],22:[function(e,t,r){t.exports=Object.keys||function e(t){var r=[];var n=Object.prototype.hasOwnProperty;for(var i in t){if(n.call(t,i)){r.push(i)}}return r}},{}],23:[function(e,w,S){(function(T){(function(e){var t=typeof S=="object"&&S;var r=typeof w=="object"&&w&&w.exports==t&&w;var n=typeof T=="object"&&T;if(n.global===n||n.window===n){e=n}var o=String.fromCharCode;function c(e){var t=[];var r=0;var n=e.length;var i;var o;while(r<n){i=e.charCodeAt(r++);if(i>=55296&&i<=56319&&r<n){o=e.charCodeAt(r++);if((o&64512)==56320){t.push(((i&1023)<<10)+(o&1023)+65536)}else{t.push(i);r--}}else{t.push(i)}}return t}function a(e){var t=e.length;var r=-1;var n;var i="";while(++r<t){n=e[r];if(n>65535){n-=65536;i+=o(n>>>10&1023|55296);n=56320|n&1023}i+=o(n)}return i}function s(e,t){if(e>=55296&&e<=57343){if(t){throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}return false}return true}function i(e,t){return o(e>>t&63|128)}function f(e,t){if((e&4294967168)==0){return o(e)}var r="";if((e&4294965248)==0){r=o(e>>6&31|192)}else if((e&4294901760)==0){if(!s(e,t)){e=65533}r=o(e>>12&15|224);r+=i(e,6)}else if((e&4292870144)==0){r=o(e>>18&7|240);r+=i(e,12);r+=i(e,6)}r+=o(e&63|128);return r}function p(e,t){t=t||{};var r=false!==t.strict;var n=c(e);var i=n.length;var o=-1;var a;var s="";while(++o<i){a=n[o];s+=f(a,r)}return s}function u(){if(v>=h){throw Error("Invalid byte index")}var e=l[v]&255;v++;if((e&192)==128){return e&63}throw Error("Invalid continuation byte")}function d(e){var t;var r;var n;var i;var o;if(v>h){throw Error("Invalid byte index")}if(v==h){return false}t=l[v]&255;v++;if((t&128)==0){return t}if((t&224)==192){r=u();o=(t&31)<<6|r;if(o>=128){return o}else{throw Error("Invalid continuation byte")}}if((t&240)==224){r=u();n=u();o=(t&15)<<12|r<<6|n;if(o>=2048){return s(o,e)?o:65533}else{throw Error("Invalid continuation byte")}}if((t&248)==240){r=u();n=u();i=u();o=(t&7)<<18|r<<12|n<<6|i;if(o>=65536&&o<=1114111){return o}}throw Error("Invalid UTF-8 detected")}var l;var h;var v;function m(e,t){t=t||{};var r=false!==t.strict;l=c(e);h=l.length;v=0;var n=[];var i;while((i=d(r))!==false){n.push(i)}return a(n)}var y={version:"2.1.2",encode:p,decode:m};if(typeof k=="function"&&typeof k.amd=="object"&&k.amd){k(function(){return y})}else if(t&&!t.nodeType){if(r){r.exports=y}else{var g={};var C=g.hasOwnProperty;for(var b in y){C.call(y,b)&&(t[b]=y[b])}}}else{e.utf8=y}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],24:[function(t,r,e){(function(i){var o=t("isarray");var e=Object.prototype.toString;var a=typeof i.Blob==="function"||e.call(i.Blob)==="[object BlobConstructor]";var s=typeof i.File==="function"||e.call(i.File)==="[object FileConstructor]";r.exports=c;function c(e){if(!e||typeof e!=="object"){return false}if(o(e)){for(var t=0,r=e.length;t<r;t++){if(c(e[t])){return true}}return false}if(typeof i.Buffer==="function"&&i.Buffer.isBuffer&&i.Buffer.isBuffer(e)||typeof i.ArrayBuffer==="function"&&e instanceof ArrayBuffer||a&&e instanceof Blob||s&&e instanceof File){return true}if(e.toJSON&&typeof e.toJSON==="function"&&arguments.length===1){return c(e.toJSON(),true)}for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n)&&c(e[n])){return true}}return false}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{isarray:25}],25:[function(e,t,r){var n={}.toString;t.exports=Array.isArray||function(e){return n.call(e)=="[object Array]"}},{}],26:[function(e,t,r){try{t.exports=typeof XMLHttpRequest!=="undefined"&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=false}},{}],27:[function(e,t,r){var n=[].indexOf;t.exports=function(e,t){if(n)return e.indexOf(t);for(var r=0;r<e.length;++r){if(e[r]===t)return r}return-1}},{}],28:[function(e,t,r){var i=1e3;var o=i*60;var a=o*60;var s=a*24;var c=s*365.25;t.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0){return n(e)}else if(r==="number"&&isNaN(e)===false){return t.long?p(e):f(e)}throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function n(e){e=String(e);if(e.length>100){return}var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t){return}var r=parseFloat(t[1]);var n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*c;case"days":case"day":case"d":return r*s;case"hours":case"hour":case"hrs":case"hr":case"h":return r*a;case"minutes":case"minute":case"mins":case"min":case"m":return r*o;case"seconds":case"second":case"secs":case"sec":case"s":return r*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return undefined}}function f(e){if(e>=s){return Math.round(e/s)+"d"}if(e>=a){return Math.round(e/a)+"h"}if(e>=o){return Math.round(e/o)+"m"}if(e>=i){return Math.round(e/i)+"s"}return e+"ms"}function p(e){return u(e,s,"day")||u(e,a,"hour")||u(e,o,"minute")||u(e,i,"second")||e+" ms"}function u(e,t,r){if(e<t){return}if(e<t*1.5){return Math.floor(e/t)+" "+r}return Math.ceil(e/t)+" "+r+"s"}},{}],29:[function(e,t,r){r.encode=function(e){var t="";for(var r in e){if(e.hasOwnProperty(r)){if(t.length)t+="&";t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r])}}return t};r.decode=function(e){var t={};var r=e.split("&");for(var n=0,i=r.length;n<i;n++){var o=r[n].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},{}],30:[function(e,t,r){var c=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var f=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function e(t){var r=t,n=t.indexOf("["),i=t.indexOf("]");if(n!=-1&&i!=-1){t=t.substring(0,n)+t.substring(n,i).replace(/:/g,";")+t.substring(i,t.length)}var o=c.exec(t||""),a={},s=14;while(s--){a[f[s]]=o[s]||""}if(n!=-1&&i!=-1){a.source=r;a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":");a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":");a.ipv6uri=true}return a}},{}],31:[function(e,t,r){var n=t.exports={};var i;var o;function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){i=setTimeout}else{i=a}}catch(e){i=a}try{if(typeof clearTimeout==="function"){o=clearTimeout}else{o=s}}catch(e){o=s}})();function c(t){if(i===setTimeout){return setTimeout(t,0)}if((i===a||!i)&&setTimeout){i=setTimeout;return setTimeout(t,0)}try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}function f(t){if(o===clearTimeout){return clearTimeout(t)}if((o===s||!o)&&clearTimeout){o=clearTimeout;return clearTimeout(t)}try{return o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}var p=[];var u=false;var d;var l=-1;function h(){if(!u||!d){return}u=false;if(d.length){p=d.concat(p)}else{l=-1}if(p.length){v()}}function v(){if(u){return}var e=c(h);u=true;var t=p.length;while(t){d=p;p=[];while(++l<t){if(d){d[l].run()}}l=-1;t=p.length}d=null;u=false;f(e)}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}}p.push(new m(e,t));if(p.length===1&&!u){c(v)}};function m(e,t){this.fun=e;this.array=t}m.prototype.run=function(){this.fun.apply(null,this.array)};n.title="browser";n.browser=true;n.env={};n.argv=[];n.version="";n.versions={};function y(){}n.on=y;n.addListener=y;n.once=y;n.off=y;n.removeListener=y;n.removeAllListeners=y;n.emit=y;n.prependListener=y;n.prependOnceListener=y;n.listeners=function(e){return[]};n.binding=function(e){throw new Error("process.binding is not supported")};n.cwd=function(){return"/"};n.chdir=function(e){throw new Error("process.chdir is not supported")};n.umask=function(){return 0}},{}],32:[function(e,t,r){"use strict";var N=e("sdp");function o(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}function c(e,t,r,n,i){var o=N.writeRtpDescription(e.kind,t);o+=N.writeIceParameters(e.iceGatherer.getLocalParameters());o+=N.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":i||"active");o+="a=mid:"+e.mid+"\r\n";if(e.rtpSender&&e.rtpReceiver){o+="a=sendrecv\r\n"}else if(e.rtpSender){o+="a=sendonly\r\n"}else if(e.rtpReceiver){o+="a=recvonly\r\n"}else{o+="a=inactive\r\n"}if(e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var s="msid:"+(n?n.id:"-")+" "+a+"\r\n";o+="a="+s;o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s;if(e.sendEncodingParameters[0].rtx){o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s;o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+N.localCName+"\r\n";if(e.rtpSender&&e.sendEncodingParameters[0].rtx){o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+N.localCName+"\r\n"}return o}function a(e,n){var i=false;e=JSON.parse(JSON.stringify(e));return e.filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;if(e.url&&!e.urls){console.warn("RTCIceServer.url is deprecated! Use urls instead.")}var r=typeof t==="string";if(r){t=[t]}t=t.filter(function(e){var t=e.indexOf("turn:")===0&&e.indexOf("transport=udp")!==-1&&e.indexOf("turn:[")===-1&&!i;if(t){i=true;return true}return e.indexOf("stun:")===0&&n>=14393&&e.indexOf("?transport=udp")===-1});delete e.url;e.urls=r?t[0]:t;return!!t.length}})}function v(n,i){var o={codecs:[],headerExtensions:[],fecMechanisms:[]};var a=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++){if(t[r].payloadType===e||t[r].preferredPayloadType===e){return t[r]}}};var s=function(e,t,r,n){var i=a(e.parameters.apt,r);var o=a(t.parameters.apt,n);return i&&o&&i.name.toLowerCase()===o.name.toLowerCase()};n.codecs.forEach(function(r){for(var e=0;e<i.codecs.length;e++){var t=i.codecs[e];if(r.name.toLowerCase()===t.name.toLowerCase()&&r.clockRate===t.clockRate){if(r.name.toLowerCase()==="rtx"&&r.parameters&&t.parameters.apt){if(!s(r,t,n.codecs,i.codecs)){continue}}t=JSON.parse(JSON.stringify(t));t.numChannels=Math.min(r.numChannels,t.numChannels);o.codecs.push(t);t.rtcpFeedback=t.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++){if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter){return true}}return false});break}}});n.headerExtensions.forEach(function(e){for(var t=0;t<i.headerExtensions.length;t++){var r=i.headerExtensions[t];if(e.uri===r.uri){o.headerExtensions.push(r);break}}});return o}function s(e,t,r){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)!==-1}function B(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});if(!r){e.addRemoteCandidate(t)}return!r}function u(e,t){var r=new Error(t);r.name=e;r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:undefined,OperationError:undefined}[e];return r}t.exports=function(M,I){function j(e,t){t.addTrack(e);t.dispatchEvent(new M.MediaStreamTrackEvent("addtrack",{track:e}))}function L(e,t){t.removeTrack(e);t.dispatchEvent(new M.MediaStreamTrackEvent("removetrack",{track:e}))}function i(e,t,r,n){var i=new Event("track");i.track=t;i.receiver=r;i.transceiver={receiver:r};i.streams=n;M.setTimeout(function(){e._dispatchEvent("track",i)})}var n=function(e){var t=this;var r=document.createDocumentFragment();["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){t[e]=r[e].bind(r)});this.canTrickleIceCandidates=null;this.needNegotiation=false;this.localStreams=[];this.remoteStreams=[];this.localDescription=null;this.remoteDescription=null;this.signalingState="stable";this.iceConnectionState="new";this.connectionState="new";this.iceGatheringState="new";e=JSON.parse(JSON.stringify(e||{}));this.usingBundle=e.bundlePolicy==="max-bundle";if(e.rtcpMuxPolicy==="negotiate"){throw u("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported")}else if(!e.rtcpMuxPolicy){e.rtcpMuxPolicy="require"}switch(e.iceTransportPolicy){case"all":case"relay":break;default:e.iceTransportPolicy="all";break}switch(e.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:e.bundlePolicy="balanced";break}e.iceServers=a(e.iceServers||[],I);this._iceGatherers=[];if(e.iceCandidatePoolSize){for(var n=e.iceCandidatePoolSize;n>0;n--){this._iceGatherers.push(new M.RTCIceGatherer({iceServers:e.iceServers,gatherPolicy:e.iceTransportPolicy}))}}else{e.iceCandidatePoolSize=0}this._config=e;this.transceivers=[];this._sdpSessionId=N.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=undefined;this._isClosed=false};n.prototype.onicecandidate=null;n.prototype.onaddstream=null;n.prototype.ontrack=null;n.prototype.onremovestream=null;n.prototype.onsignalingstatechange=null;n.prototype.oniceconnectionstatechange=null;n.prototype.onconnectionstatechange=null;n.prototype.onicegatheringstatechange=null;n.prototype.onnegotiationneeded=null;n.prototype.ondatachannel=null;n.prototype._dispatchEvent=function(e,t){if(this._isClosed){return}this.dispatchEvent(t);if(typeof this["on"+e]==="function"){this["on"+e](t)}};n.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)};n.prototype.getConfiguration=function(){return this._config};n.prototype.getLocalStreams=function(){return this.localStreams};n.prototype.getRemoteStreams=function(){return this.remoteStreams};n.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0;var n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:true};if(this.usingBundle&&r){n.iceTransport=this.transceivers[0].iceTransport;n.dtlsTransport=this.transceivers[0].dtlsTransport}else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport;n.dtlsTransport=i.dtlsTransport}if(!t){this.transceivers.push(n)}return n};n.prototype.addTrack=function(t,e){if(this._isClosed){throw u("InvalidStateError","Attempted to call addTrack on a closed peerconnection.")}var r=this.transceivers.find(function(e){return e.track===t});if(r){throw u("InvalidAccessError","Track already exists.")}var n;for(var i=0;i<this.transceivers.length;i++){if(!this.transceivers[i].track&&this.transceivers[i].kind===t.kind){n=this.transceivers[i]}}if(!n){n=this._createTransceiver(t.kind)}this._maybeFireNegotiationNeeded();if(this.localStreams.indexOf(e)===-1){this.localStreams.push(e)}n.track=t;n.stream=e;n.rtpSender=new M.RTCRtpSender(t,n.dtlsTransport);return n.rtpSender};n.prototype.addStream=function(t){var r=this;if(I>=15025){t.getTracks().forEach(function(e){r.addTrack(e,t)})}else{var n=t.clone();t.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})});n.getTracks().forEach(function(e){r.addTrack(e,n)})}};n.prototype.removeTrack=function(t){if(this._isClosed){throw u("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.")}if(!(t instanceof M.RTCRtpSender)){throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack "+"does not implement interface RTCRtpSender.")}var e=this.transceivers.find(function(e){return e.rtpSender===t});if(!e){throw u("InvalidAccessError","Sender was not created by this connection.")}var r=e.stream;e.rtpSender.stop();e.rtpSender=null;e.track=null;e.stream=null;var n=this.transceivers.map(function(e){return e.stream});if(n.indexOf(r)===-1&&this.localStreams.indexOf(r)>-1){this.localStreams.splice(this.localStreams.indexOf(r),1)}this._maybeFireNegotiationNeeded()};n.prototype.removeStream=function(e){var r=this;e.getTracks().forEach(function(t){var e=r.getSenders().find(function(e){return e.track===t});if(e){r.removeTrack(e)}})};n.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})};n.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})};n.prototype._createIceGatherer=function(r,e){var n=this;if(e&&r>0){return this.transceivers[0].iceGatherer}else if(this._iceGatherers.length){return this._iceGatherers.shift()}var i=new M.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});Object.defineProperty(i,"state",{value:"new",writable:true});this.transceivers[r].bufferedCandidateEvents=[];this.transceivers[r].bufferCandidates=function(e){var t=!e.candidate||Object.keys(e.candidate).length===0;i.state=t?"completed":"gathering";if(n.transceivers[r].bufferedCandidateEvents!==null){n.transceivers[r].bufferedCandidateEvents.push(e)}};i.addEventListener("localcandidate",this.transceivers[r].bufferCandidates);return i};n.prototype._gather=function(s,c){var f=this;var p=this.transceivers[c].iceGatherer;if(p.onlocalcandidate){return}var e=this.transceivers[c].bufferedCandidateEvents;this.transceivers[c].bufferedCandidateEvents=null;p.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates);p.onlocalcandidate=function(e){if(f.usingBundle&&c>0){return}var t=new Event("icecandidate");t.candidate={sdpMid:s,sdpMLineIndex:c};var r=e.candidate;var n=!r||Object.keys(r).length===0;if(n){if(p.state==="new"||p.state==="gathering"){p.state="completed"}}else{if(p.state==="new"){p.state="gathering"}r.component=1;r.ufrag=p.getLocalParameters().usernameFragment;var i=N.writeCandidate(r);t.candidate=Object.assign(t.candidate,N.parseCandidate(i));t.candidate.candidate=i;t.candidate.toJSON=function(){return{candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex,usernameFragment:t.candidate.usernameFragment}}}var o=N.getMediaSections(f.localDescription.sdp);if(!n){o[t.candidate.sdpMLineIndex]+="a="+t.candidate.candidate+"\r\n"}else{o[t.candidate.sdpMLineIndex]+="a=end-of-candidates\r\n"}f.localDescription.sdp=N.getDescription(f.localDescription.sdp)+o.join("");var a=f.transceivers.every(function(e){return e.iceGatherer&&e.iceGatherer.state==="completed"});if(f.iceGatheringState!=="gathering"){f.iceGatheringState="gathering";f._emitGatheringStateChange()}if(!n){f._dispatchEvent("icecandidate",t)}if(a){f._dispatchEvent("icecandidate",new Event("icecandidate"));f.iceGatheringState="complete";f._emitGatheringStateChange()}};M.setTimeout(function(){e.forEach(function(e){p.onlocalcandidate(e)})},0)};n.prototype._createIceAndDtlsTransports=function(){var e=this;var t=new M.RTCIceTransport(null);t.onicestatechange=function(){e._updateIceConnectionState();e._updateConnectionState()};var r=new M.RTCDtlsTransport(t);r.ondtlsstatechange=function(){e._updateConnectionState()};r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:true});e._updateConnectionState()};return{iceTransport:t,dtlsTransport:r}};n.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;if(t){delete t.onlocalcandidate;delete this.transceivers[e].iceGatherer}var r=this.transceivers[e].iceTransport;if(r){delete r.onicestatechange;delete this.transceivers[e].iceTransport}var n=this.transceivers[e].dtlsTransport;if(n){delete n.ondtlsstatechange;delete n.onerror;delete this.transceivers[e].dtlsTransport}};n.prototype._transceive=function(e,t,r){var n=v(e.localCapabilities,e.remoteCapabilities);if(t&&e.rtpSender){n.encodings=e.sendEncodingParameters;n.rtcp={cname:N.localCName,compound:e.rtcpParameters.compound};if(e.recvEncodingParameters.length){n.rtcp.ssrc=e.recvEncodingParameters[0].ssrc}e.rtpSender.send(n)}if(r&&e.rtpReceiver&&n.codecs.length>0){if(e.kind==="video"&&e.recvEncodingParameters&&I<15019){e.recvEncodingParameters.forEach(function(e){delete e.rtx})}if(e.recvEncodingParameters.length){n.encodings=e.recvEncodingParameters}else{n.encodings=[{}]}n.rtcp={compound:e.rtcpParameters.compound};if(e.rtcpParameters.cname){n.rtcp.cname=e.rtcpParameters.cname}if(e.sendEncodingParameters.length){n.rtcp.ssrc=e.sendEncodingParameters[0].ssrc}e.rtpReceiver.receive(n)}};n.prototype.setLocalDescription=function(e){var d=this;if(["offer","answer"].indexOf(e.type)===-1){return Promise.reject(u("TypeError",'Unsupported type "'+e.type+'"'))}if(!s("setLocalDescription",e.type,d.signalingState)||d._isClosed){return Promise.reject(u("InvalidStateError","Can not set local "+e.type+" in state "+d.signalingState))}var t;var l;if(e.type==="offer"){t=N.splitSections(e.sdp);l=t.shift();t.forEach(function(e,t){var r=N.parseRtpParameters(e);d.transceivers[t].localCapabilities=r});d.transceivers.forEach(function(e,t){d._gather(e.mid,t)})}else if(e.type==="answer"){t=N.splitSections(d.remoteDescription.sdp);l=t.shift();var h=N.matchPrefix(l,"a=ice-lite").length>0;t.forEach(function(e,t){var r=d.transceivers[t];var n=r.iceGatherer;var i=r.iceTransport;var o=r.dtlsTransport;var a=r.localCapabilities;var s=r.remoteCapabilities;var c=N.isRejected(e)&&N.matchPrefix(e,"a=bundle-only").length===0;if(!c&&!r.rejected){var f=N.getIceParameters(e,l);var p=N.getDtlsParameters(e,l);if(h){p.role="server"}if(!d.usingBundle||t===0){d._gather(r.mid,t);if(i.state==="new"){i.start(n,f,h?"controlling":"controlled")}if(o.state==="new"){o.start(p)}}var u=v(a,s);d._transceive(r,u.codecs.length>0,false)}})}d.localDescription={type:e.type,sdp:e.sdp};if(e.type==="offer"){d._updateSignalingState("have-local-offer")}else{d._updateSignalingState("stable")}return Promise.resolve()};n.prototype.setRemoteDescription=function(P){var E=this;if(["offer","answer"].indexOf(P.type)===-1){return Promise.reject(u("TypeError",'Unsupported type "'+P.type+'"'))}if(!s("setRemoteDescription",P.type,E.signalingState)||E._isClosed){return Promise.reject(u("InvalidStateError","Can not set remote "+P.type+" in state "+E.signalingState))}var x={};E.remoteStreams.forEach(function(e){x[e.id]=e});var _=[];var e=N.splitSections(P.sdp);var O=e.shift();var A=N.matchPrefix(O,"a=ice-lite").length>0;var D=N.matchPrefix(O,"a=group:BUNDLE ").length>0;E.usingBundle=D;var t=N.matchPrefix(O,"a=ice-options:")[0];if(t){E.canTrickleIceCandidates=t.substr(14).split(" ").indexOf("trickle")>=0}else{E.canTrickleIceCandidates=false}e.forEach(function(e,t){var r=N.splitLines(e);var n=N.getKind(e);var i=N.isRejected(e)&&N.matchPrefix(e,"a=bundle-only").length===0;var o=r[0].substr(2).split(" ")[2];var a=N.getDirection(e,O);var s=N.parseMsid(e);var c=N.getMid(e)||N.generateIdentifier();if(n==="application"&&o==="DTLS/SCTP"||i){E.transceivers[t]={mid:c,kind:n,rejected:true};return}if(!i&&E.transceivers[t]&&E.transceivers[t].rejected){E.transceivers[t]=E._createTransceiver(n,true)}var f;var p;var u;var d;var l;var h;var v;var m;var y;var g=N.parseRtpParameters(e);var C;var b;if(!i){C=N.getIceParameters(e,O);b=N.getDtlsParameters(e,O);b.role="client"}v=N.parseRtpEncodingParameters(e);var T=N.parseRtcpParameters(e);var w=N.matchPrefix(e,"a=end-of-candidates",O).length>0;var S=N.matchPrefix(e,"a=candidate:").map(function(e){return N.parseCandidate(e)}).filter(function(e){return e.component===1});if((P.type==="offer"||P.type==="answer")&&!i&&D&&t>0&&E.transceivers[t]){E._disposeIceAndDtlsTransports(t);E.transceivers[t].iceGatherer=E.transceivers[0].iceGatherer;E.transceivers[t].iceTransport=E.transceivers[0].iceTransport;E.transceivers[t].dtlsTransport=E.transceivers[0].dtlsTransport;if(E.transceivers[t].rtpSender){E.transceivers[t].rtpSender.setTransport(E.transceivers[0].dtlsTransport)}if(E.transceivers[t].rtpReceiver){E.transceivers[t].rtpReceiver.setTransport(E.transceivers[0].dtlsTransport)}}if(P.type==="offer"&&!i){f=E.transceivers[t]||E._createTransceiver(n);f.mid=c;if(!f.iceGatherer){f.iceGatherer=E._createIceGatherer(t,D)}if(S.length&&f.iceTransport.state==="new"){if(w&&(!D||t===0)){f.iceTransport.setRemoteCandidates(S)}else{S.forEach(function(e){B(f.iceTransport,e)})}}m=M.RTCRtpReceiver.getCapabilities(n);if(I<15019){m.codecs=m.codecs.filter(function(e){return e.name!=="rtx"})}h=f.sendEncodingParameters||[{ssrc:(2*t+2)*1001}];var k=false;if(a==="sendrecv"||a==="sendonly"){k=!f.rtpReceiver;l=f.rtpReceiver||new M.RTCRtpReceiver(f.dtlsTransport,n);if(k){var R;y=l.track;if(s&&s.stream==="-"){}else if(s){if(!x[s.stream]){x[s.stream]=new M.MediaStream;Object.defineProperty(x[s.stream],"id",{get:function(){return s.stream}})}Object.defineProperty(y,"id",{get:function(){return s.track}});R=x[s.stream]}else{if(!x.default){x.default=new M.MediaStream}R=x.default}if(R){j(y,R);f.associatedRemoteMediaStreams.push(R)}_.push([y,l,R])}}else if(f.rtpReceiver&&f.rtpReceiver.track){f.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===f.rtpReceiver.track.id});if(t){L(t,e)}});f.associatedRemoteMediaStreams=[]}f.localCapabilities=m;f.remoteCapabilities=g;f.rtpReceiver=l;f.rtcpParameters=T;f.sendEncodingParameters=h;f.recvEncodingParameters=v;E._transceive(E.transceivers[t],false,k)}else if(P.type==="answer"&&!i){f=E.transceivers[t];p=f.iceGatherer;u=f.iceTransport;d=f.dtlsTransport;l=f.rtpReceiver;h=f.sendEncodingParameters;m=f.localCapabilities;E.transceivers[t].recvEncodingParameters=v;E.transceivers[t].remoteCapabilities=g;E.transceivers[t].rtcpParameters=T;if(S.length&&u.state==="new"){if((A||w)&&(!D||t===0)){u.setRemoteCandidates(S)}else{S.forEach(function(e){B(f.iceTransport,e)})}}if(!D||t===0){if(u.state==="new"){u.start(p,C,"controlling")}if(d.state==="new"){d.start(b)}}E._transceive(f,a==="sendrecv"||a==="recvonly",a==="sendrecv"||a==="sendonly");if(l&&(a==="sendrecv"||a==="sendonly")){y=l.track;if(s){if(!x[s.stream]){x[s.stream]=new M.MediaStream}j(y,x[s.stream]);_.push([y,l,x[s.stream]])}else{if(!x.default){x.default=new M.MediaStream}j(y,x.default);_.push([y,l,x.default])}}else{delete f.rtpReceiver}}});if(E._dtlsRole===undefined){E._dtlsRole=P.type==="offer"?"active":"passive"}E.remoteDescription={type:P.type,sdp:P.sdp};if(P.type==="offer"){E._updateSignalingState("have-remote-offer")}else{E._updateSignalingState("stable")}Object.keys(x).forEach(function(e){var n=x[e];if(n.getTracks().length){if(E.remoteStreams.indexOf(n)===-1){E.remoteStreams.push(n);var t=new Event("addstream");t.stream=n;M.setTimeout(function(){E._dispatchEvent("addstream",t)})}_.forEach(function(e){var t=e[0];var r=e[1];if(n.id!==e[2].id){return}i(E,t,r,[n])})}});_.forEach(function(e){if(e[2]){return}i(E,e[0],e[1],[])});M.setTimeout(function(){if(!(E&&E.transceivers)){return}E.transceivers.forEach(function(e){if(e.iceTransport&&e.iceTransport.state==="new"&&e.iceTransport.getRemoteCandidates().length>0){console.warn("Timeout for addRemoteCandidate. Consider sending "+"an end-of-candidates notification");e.iceTransport.addRemoteCandidate({})}})},4e3);return Promise.resolve()};n.prototype.close=function(){this.transceivers.forEach(function(e){if(e.iceTransport){e.iceTransport.stop()}if(e.dtlsTransport){e.dtlsTransport.stop()}if(e.rtpSender){e.rtpSender.stop()}if(e.rtpReceiver){e.rtpReceiver.stop()}});this._isClosed=true;this._updateSignalingState("closed")};n.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)};n.prototype._maybeFireNegotiationNeeded=function(){var t=this;if(this.signalingState!=="stable"||this.needNegotiation===true){return}this.needNegotiation=true;M.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=false;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0)};n.prototype._updateIceConnectionState=function(){var e;var t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){t[e.iceTransport.state]++});e="new";if(t.failed>0){e="failed"}else if(t.checking>0){e="checking"}else if(t.disconnected>0){e="disconnected"}else if(t.new>0){e="new"}else if(t.connected>0){e="connected"}else if(t.completed>0){e="completed"}if(e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}};n.prototype._updateConnectionState=function(){var e;var t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){t[e.iceTransport.state]++;t[e.dtlsTransport.state]++});t.connected+=t.completed;e="new";if(t.failed>0){e="failed"}else if(t.connecting>0){e="connecting"}else if(t.disconnected>0){e="disconnected"}else if(t.new>0){e="new"}else if(t.connected>0){e="connected"}if(e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}};n.prototype.createOffer=function(){var s=this;if(s._isClosed){return Promise.reject(u("InvalidStateError","Can not call createOffer after close"))}var t=s.transceivers.filter(function(e){return e.kind==="audio"}).length;var r=s.transceivers.filter(function(e){return e.kind==="video"}).length;var e=arguments[0];if(e){if(e.mandatory||e.optional){throw new TypeError("Legacy mandatory/optional constraints not supported.")}if(e.offerToReceiveAudio!==undefined){if(e.offerToReceiveAudio===true){t=1}else if(e.offerToReceiveAudio===false){t=0}else{t=e.offerToReceiveAudio}}if(e.offerToReceiveVideo!==undefined){if(e.offerToReceiveVideo===true){r=1}else if(e.offerToReceiveVideo===false){r=0}else{r=e.offerToReceiveVideo}}}s.transceivers.forEach(function(e){if(e.kind==="audio"){t--;if(t<0){e.wantReceive=false}}else if(e.kind==="video"){r--;if(r<0){e.wantReceive=false}}});while(t>0||r>0){if(t>0){s._createTransceiver("audio");t--}if(r>0){s._createTransceiver("video");r--}}var n=N.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++);s.transceivers.forEach(function(r,e){var t=r.track;var n=r.kind;var i=r.mid||N.generateIdentifier();r.mid=i;if(!r.iceGatherer){r.iceGatherer=s._createIceGatherer(e,s.usingBundle)}var o=M.RTCRtpSender.getCapabilities(n);if(I<15019){o.codecs=o.codecs.filter(function(e){return e.name!=="rtx"})}o.codecs.forEach(function(t){if(t.name==="H264"&&t.parameters["level-asymmetry-allowed"]===undefined){t.parameters["level-asymmetry-allowed"]="1"}if(r.remoteCapabilities&&r.remoteCapabilities.codecs){r.remoteCapabilities.codecs.forEach(function(e){if(t.name.toLowerCase()===e.name.toLowerCase()&&t.clockRate===e.clockRate){t.preferredPayloadType=e.payloadType}})}});o.headerExtensions.forEach(function(t){var e=r.remoteCapabilities&&r.remoteCapabilities.headerExtensions||[];e.forEach(function(e){if(t.uri===e.uri){t.id=e.id}})});var a=r.sendEncodingParameters||[{ssrc:(2*e+1)*1001}];if(t){if(I>=15019&&n==="video"&&!a[0].rtx){a[0].rtx={ssrc:a[0].ssrc+1}}}if(r.wantReceive){r.rtpReceiver=new M.RTCRtpReceiver(r.dtlsTransport,n)}r.localCapabilities=o;r.sendEncodingParameters=a});if(s._config.bundlePolicy!=="max-compat"){n+="a=group:BUNDLE "+s.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"}n+="a=ice-options:trickle\r\n";s.transceivers.forEach(function(e,t){n+=c(e,e.localCapabilities,"offer",e.stream,s._dtlsRole);n+="a=rtcp-rsize\r\n";if(e.iceGatherer&&s.iceGatheringState!=="new"&&(t===0||!s.usingBundle)){e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1;n+="a="+N.writeCandidate(e)+"\r\n"});if(e.iceGatherer.state==="completed"){n+="a=end-of-candidates\r\n"}}});var i=new M.RTCSessionDescription({type:"offer",sdp:n});return Promise.resolve(i)};n.prototype.createAnswer=function(){var o=this;if(o._isClosed){return Promise.reject(u("InvalidStateError","Can not call createAnswer after close"))}if(!(o.signalingState==="have-remote-offer"||o.signalingState==="have-local-pranswer")){return Promise.reject(u("InvalidStateError","Can not call createAnswer in signalingState "+o.signalingState))}var a=N.writeSessionBoilerplate(o._sdpSessionId,o._sdpSessionVersion++);if(o.usingBundle){a+="a=group:BUNDLE "+o.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"}var s=N.getMediaSections(o.remoteDescription.sdp).length;o.transceivers.forEach(function(e,t){if(t+1>s){return}if(e.rejected){if(e.kind==="application"){a+="m=application 0 DTLS/SCTP 5000\r\n"}else if(e.kind==="audio"){a+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\n"+"a=rtpmap:0 PCMU/8000\r\n"}else if(e.kind==="video"){a+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\n"+"a=rtpmap:120 VP8/90000\r\n"}a+="c=IN IP4 0.0.0.0\r\n"+"a=inactive\r\n"+"a=mid:"+e.mid+"\r\n";return}if(e.stream){var r;if(e.kind==="audio"){r=e.stream.getAudioTracks()[0]}else if(e.kind==="video"){r=e.stream.getVideoTracks()[0]}if(r){if(I>=15019&&e.kind==="video"&&!e.sendEncodingParameters[0].rtx){e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}}}}var n=v(e.localCapabilities,e.remoteCapabilities);var i=n.codecs.filter(function(e){return e.name.toLowerCase()==="rtx"}).length;if(!i&&e.sendEncodingParameters[0].rtx){delete e.sendEncodingParameters[0].rtx}a+=c(e,n,"answer",e.stream,o._dtlsRole);if(e.rtcpParameters&&e.rtcpParameters.reducedSize){a+="a=rtcp-rsize\r\n"}});var e=new M.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(e)};n.prototype.addIceCandidate=function(c){var f=this;var p;if(c&&!(c.sdpMLineIndex!==undefined||c.sdpMid)){return Promise.reject(new TypeError("sdpMLineIndex or sdpMid required"))}return new Promise(function(e,t){if(!f.remoteDescription){return t(u("InvalidStateError","Can not add ICE candidate without a remote description"))}else if(!c||c.candidate===""){for(var r=0;r<f.transceivers.length;r++){if(f.transceivers[r].rejected){continue}f.transceivers[r].iceTransport.addRemoteCandidate({});p=N.getMediaSections(f.remoteDescription.sdp);p[r]+="a=end-of-candidates\r\n";f.remoteDescription.sdp=N.getDescription(f.remoteDescription.sdp)+p.join("");if(f.usingBundle){break}}}else{var n=c.sdpMLineIndex;if(c.sdpMid){for(var i=0;i<f.transceivers.length;i++){if(f.transceivers[i].mid===c.sdpMid){n=i;break}}}var o=f.transceivers[n];if(o){if(o.rejected){return e()}var a=Object.keys(c.candidate).length>0?N.parseCandidate(c.candidate):{};if(a.protocol==="tcp"&&(a.port===0||a.port===9)){return e()}if(a.component&&a.component!==1){return e()}if(n===0||n>0&&o.iceTransport!==f.transceivers[0].iceTransport){if(!B(o.iceTransport,a)){return t(u("OperationError","Can not add ICE candidate"))}}var s=c.candidate.trim();if(s.indexOf("a=")===0){s=s.substr(2)}p=N.getMediaSections(f.remoteDescription.sdp);p[n]+="a="+(a.type?s:"end-of-candidates")+"\r\n";f.remoteDescription.sdp=N.getDescription(f.remoteDescription.sdp)+p.join("")}else{return t(u("OperationError","Can not add ICE candidate"))}}e()})};n.prototype.getStats=function(t){if(t&&t instanceof M.MediaStreamTrack){var r=null;this.transceivers.forEach(function(e){if(e.rtpSender&&e.rtpSender.track===t){r=e.rtpSender}else if(e.rtpReceiver&&e.rtpReceiver.track===t){r=e.rtpReceiver}});if(!r){throw u("InvalidAccessError","Invalid selector.")}return r.getStats()}var n=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(e){if(t[e]){n.push(t[e].getStats())}})});return Promise.all(n).then(function(e){var t=new Map;e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})});return t})};var e=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];e.forEach(function(e){var t=M[e];if(t&&t.prototype&&t.prototype.getStats){var r=t.prototype.getStats;t.prototype.getStats=function(){return r.apply(this).then(function(t){var r=new Map;Object.keys(t).forEach(function(e){t[e].type=o(t[e]);r.set(e,t[e])});return r})}}});var t=["createOffer","createAnswer"];t.forEach(function(e){var r=n.prototype[e];n.prototype[e]=function(){var t=arguments;if(typeof t[0]==="function"||typeof t[1]==="function"){return r.apply(this,[arguments[2]]).then(function(e){if(typeof t[0]==="function"){t[0].apply(null,[e])}},function(e){if(typeof t[1]==="function"){t[1].apply(null,[e])}})}return r.apply(this,arguments)}});t=["setLocalDescription","setRemoteDescription","addIceCandidate"];t.forEach(function(e){var r=n.prototype[e];n.prototype[e]=function(){var t=arguments;if(typeof t[1]==="function"||typeof t[2]==="function"){return r.apply(this,arguments).then(function(){if(typeof t[1]==="function"){t[1].apply(null)}},function(e){if(typeof t[2]==="function"){t[2].apply(null,[e])}})}return r.apply(this,arguments)}});["getStats"].forEach(function(e){var t=n.prototype[e];n.prototype[e]=function(){var e=arguments;if(typeof e[1]==="function"){return t.apply(this,arguments).then(function(){if(typeof e[1]==="function"){e[1].apply(null)}})}return t.apply(this,arguments)}});return n}},{sdp:33}],33:[function(e,t,r){"use strict";var p={};p.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)};p.localCName=p.generateIdentifier();p.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})};p.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})};p.getDescription=function(e){var t=p.splitSections(e);return t&&t[0]};p.getMediaSections=function(e){var t=p.splitSections(e);t.shift();return t};p.matchPrefix=function(e,t){return p.splitLines(e).filter(function(e){return e.indexOf(t)===0})};p.parseCandidate=function(e){var t;if(e.indexOf("a=candidate:")===0){t=e.substring(12).split(" ")}else{t=e.substring(10).split(" ")}var r={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]};for(var n=8;n<t.length;n+=2){switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1];r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1];break}}return r};p.writeCandidate=function(e){var t=[];t.push(e.foundation);t.push(e.component);t.push(e.protocol.toUpperCase());t.push(e.priority);t.push(e.ip);t.push(e.port);var r=e.type;t.push("typ");t.push(r);if(r!=="host"&&e.relatedAddress&&e.relatedPort){t.push("raddr");t.push(e.relatedAddress);t.push("rport");t.push(e.relatedPort)}if(e.tcpType&&e.protocol.toLowerCase()==="tcp"){t.push("tcptype");t.push(e.tcpType)}if(e.usernameFragment||e.ufrag){t.push("ufrag");t.push(e.usernameFragment||e.ufrag)}return"candidate:"+t.join(" ")};p.parseIceOptions=function(e){return e.substr(14).split(" ")};p.parseRtpMap=function(e){var t=e.substr(9).split(" ");var r={payloadType:parseInt(t.shift(),10)};t=t[0].split("/");r.name=t[0];r.clockRate=parseInt(t[1],10);r.numChannels=t.length===3?parseInt(t[2],10):1;return r};p.writeRtpMap=function(e){var t=e.payloadType;if(e.preferredPayloadType!==undefined){t=e.preferredPayloadType}return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(e.numChannels!==1?"/"+e.numChannels:"")+"\r\n"};p.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}};p.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+"\r\n"};p.parseFmtp=function(e){var t={};var r;var n=e.substr(e.indexOf(" ")+1).split(";");for(var i=0;i<n.length;i++){r=n[i].trim().split("=");t[r[0].trim()]=r[1]}return t};p.writeFmtp=function(t){var e="";var r=t.payloadType;if(t.preferredPayloadType!==undefined){r=t.preferredPayloadType}if(t.parameters&&Object.keys(t.parameters).length){var n=[];Object.keys(t.parameters).forEach(function(e){n.push(e+"="+t.parameters[e])});e+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return e};p.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}};p.writeRtcpFb=function(e){var t="";var r=e.payloadType;if(e.preferredPayloadType!==undefined){r=e.preferredPayloadType}if(e.rtcpFeedback&&e.rtcpFeedback.length){e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})}return t};p.parseSsrcMedia=function(e){var t=e.indexOf(" ");var r={ssrc:parseInt(e.substr(7,t-7),10)};var n=e.indexOf(":",t);if(n>-1){r.attribute=e.substr(t+1,n-t-1);r.value=e.substr(n+1)}else{r.attribute=e.substr(t+1)}return r};p.getMid=function(e){var t=p.matchPrefix(e,"a=mid:")[0];if(t){return t.substr(6)}};p.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}};p.getDtlsParameters=function(e,t){var r=p.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:r.map(p.parseFingerprint)}};p.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"});return r};p.getIceParameters=function(e,t){var r=p.splitLines(e);r=r.concat(p.splitLines(t));var n={usernameFragment:r.filter(function(e){return e.indexOf("a=ice-ufrag:")===0})[0].substr(12),password:r.filter(function(e){return e.indexOf("a=ice-pwd:")===0})[0].substr(10)};return n};p.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\n"+"a=ice-pwd:"+e.password+"\r\n"};p.parseRtpParameters=function(e){var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]};var r=p.splitLines(e);var n=r[0].split(" ");for(var i=3;i<n.length;i++){var o=n[i];var a=p.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=p.parseRtpMap(a);var c=p.matchPrefix(e,"a=fmtp:"+o+" ");s.parameters=c.length?p.parseFmtp(c[0]):{};s.rtcpFeedback=p.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(p.parseRtcpFb);t.codecs.push(s);switch(s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase());break;default:break}}}p.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(p.parseExtmap(e))});return t};p.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ";r+=t.codecs.length>0?"9":"0";r+=" UDP/TLS/RTP/SAVPF ";r+=t.codecs.map(function(e){if(e.preferredPayloadType!==undefined){return e.preferredPayloadType}return e.payloadType}).join(" ")+"\r\n";r+="c=IN IP4 0.0.0.0\r\n";r+="a=rtcp:9 IN IP4 0.0.0.0\r\n";t.codecs.forEach(function(e){r+=p.writeRtpMap(e);r+=p.writeFmtp(e);r+=p.writeRtcpFb(e)});var n=0;t.codecs.forEach(function(e){if(e.maxptime>n){n=e.maxptime}});if(n>0){r+="a=maxptime:"+n+"\r\n"}r+="a=rtcp-mux\r\n";t.headerExtensions.forEach(function(e){r+=p.writeExtmap(e)});return r};p.parseRtpEncodingParameters=function(e){var r=[];var t=p.parseRtpParameters(e);var n=t.fecMechanisms.indexOf("RED")!==-1;var i=t.fecMechanisms.indexOf("ULPFEC")!==-1;var o=p.matchPrefix(e,"a=ssrc:").map(function(e){return p.parseSsrcMedia(e)}).filter(function(e){return e.attribute==="cname"});var a=o.length>0&&o[0].ssrc;var s;var c=p.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");t.shift();return t.map(function(e){return parseInt(e,10)})});if(c.length>0&&c[0].length>1&&c[0][0]===a){s=c[0][1]}t.codecs.forEach(function(e){if(e.name.toUpperCase()==="RTX"&&e.parameters.apt){var t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:s}};r.push(t);if(n){t=JSON.parse(JSON.stringify(t));t.fec={ssrc:s,mechanism:i?"red+ulpfec":"red"};r.push(t)}}});if(r.length===0&&a){r.push({ssrc:a})}var f=p.matchPrefix(e,"b=");if(f.length){if(f[0].indexOf("b=TIAS:")===0){f=parseInt(f[0].substr(7),10)}else if(f[0].indexOf("b=AS:")===0){f=parseInt(f[0].substr(5),10)*1e3*.95-50*40*8}else{f=undefined}r.forEach(function(e){e.maxBitrate=f})}return r};p.parseRtcpParameters=function(e){var t={};var r;var n=p.matchPrefix(e,"a=ssrc:").map(function(e){return p.parseSsrcMedia(e)}).filter(function(e){return e.attribute==="cname"})[0];if(n){t.cname=n.value;t.ssrc=n.ssrc}var i=p.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0;t.compound=i.length===0;var o=p.matchPrefix(e,"a=rtcp-mux");t.mux=o.length>0;return t};p.parseMsid=function(e){var t;var r=p.matchPrefix(e,"a=msid:");if(r.length===1){t=r[0].substr(7).split(" ");return{stream:t[0],track:t[1]}}var n=p.matchPrefix(e,"a=ssrc:").map(function(e){return p.parseSsrcMedia(e)}).filter(function(e){return e.attribute==="msid"});if(n.length>0){t=n[0].value.split(" ");return{stream:t[0],track:t[1]}}};p.generateSessionId=function(){return Math.random().toString().substr(2,21)};p.writeSessionBoilerplate=function(e,t){var r;var n=t!==undefined?t:2;if(e){r=e}else{r=p.generateSessionId()}return"v=0\r\n"+"o=thisisadapterortc "+r+" "+n+" IN IP4 127.0.0.1\r\n"+"s=-\r\n"+"t=0 0\r\n"};p.writeMediaSection=function(e,t,r,n){var i=p.writeRtpDescription(e.kind,t);i+=p.writeIceParameters(e.iceGatherer.getLocalParameters());i+=p.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":"active");i+="a=mid:"+e.mid+"\r\n";if(e.direction){i+="a="+e.direction+"\r\n"}else if(e.rtpSender&&e.rtpReceiver){i+="a=sendrecv\r\n"}else if(e.rtpSender){i+="a=sendonly\r\n"}else if(e.rtpReceiver){i+="a=recvonly\r\n"}else{i+="a=inactive\r\n"}if(e.rtpSender){var o="msid:"+n.id+" "+e.rtpSender.track.id+"\r\n";i+="a="+o;i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o;if(e.sendEncodingParameters[0].rtx){i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o;i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+p.localCName+"\r\n";if(e.rtpSender&&e.sendEncodingParameters[0].rtx){i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+p.localCName+"\r\n"}return i};p.getDirection=function(e,t){var r=p.splitLines(e);for(var n=0;n<r.length;n++){switch(r[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[n].substr(2);default:}}if(t){return p.getDirection(t)}return"sendrecv"};p.getKind=function(e){var t=p.splitLines(e);var r=t[0].split(" ");return r[0].substr(2)};p.isRejected=function(e){return e.split(" ",2)[1]==="0"};p.parseMLine=function(e){var t=p.splitLines(e);var r=t[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}};p.parseOLine=function(e){var t=p.matchPrefix(e,"o=")[0];var r=t.substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}};if(typeof t==="object"){t.exports=p}},{}],34:[function(e,t,r){var f=e("./url");var n=e("socket.io-parser");var p=e("./manager");var u=e("debug")("socket.io-client");t.exports=r=i;var d=r.managers={};function i(e,t){if(typeof e==="object"){t=e;e=undefined}t=t||{};var r=f(e);var n=r.source;var i=r.id;var o=r.path;var a=d[i]&&o in d[i].nsps;var s=t.forceNew||t["force new connection"]||false===t.multiplex||a;var c;if(s){u("ignoring socket cache for %s",n);c=p(n,t)}else{if(!d[i]){u("new io instance for %s",n);d[i]=p(n,t)}c=d[i]}if(r.query&&!t.query){t.query=r.query}return c.socket(r.path,t)}r.protocol=n.protocol;r.connect=i;r.Manager=e("./manager");r.Socket=e("./socket")},{"./manager":35,"./socket":37,"./url":38,debug:39,"socket.io-parser":42}],35:[function(e,t,r){var c=e("engine.io-client");var o=e("./socket");var n=e("component-emitter");var i=e("socket.io-parser");var f=e("./on");var a=e("component-bind");var p=e("debug")("socket.io-client:manager");var s=e("indexof");var u=e("backo2");var d=Object.prototype.hasOwnProperty;t.exports=l;function l(e,t){if(!(this instanceof l))return new l(e,t);if(e&&"object"===typeof e){t=e;e=undefined}t=t||{};t.path=t.path||"/socket.io";this.nsps={};this.subs=[];this.opts=t;this.reconnection(t.reconnection!==false);this.reconnectionAttempts(t.reconnectionAttempts||Infinity);this.reconnectionDelay(t.reconnectionDelay||1e3);this.reconnectionDelayMax(t.reconnectionDelayMax||5e3);this.randomizationFactor(t.randomizationFactor||.5);this.backoff=new u({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==t.timeout?2e4:t.timeout);this.readyState="closed";this.uri=e;this.connecting=[];this.lastPing=null;this.encoding=false;this.packetBuffer=[];var r=t.parser||i;this.encoder=new r.Encoder;this.decoder=new r.Decoder;this.autoConnect=t.autoConnect!==false;if(this.autoConnect)this.open()}l.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var e in this.nsps){if(d.call(this.nsps,e)){this.nsps[e].emit.apply(this.nsps[e],arguments)}}};l.prototype.updateSocketIds=function(){for(var e in this.nsps){if(d.call(this.nsps,e)){this.nsps[e].id=this.generateId(e)}}};l.prototype.generateId=function(e){return(e==="/"?"":e+"#")+this.engine.id};n(l.prototype);l.prototype.reconnection=function(e){if(!arguments.length)return this._reconnection;this._reconnection=!!e;return this};l.prototype.reconnectionAttempts=function(e){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=e;return this};l.prototype.reconnectionDelay=function(e){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=e;this.backoff&&this.backoff.setMin(e);return this};l.prototype.randomizationFactor=function(e){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=e;this.backoff&&this.backoff.setJitter(e);return this};l.prototype.reconnectionDelayMax=function(e){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=e;this.backoff&&this.backoff.setMax(e);return this};l.prototype.timeout=function(e){if(!arguments.length)return this._timeout;this._timeout=e;return this};l.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};l.prototype.open=l.prototype.connect=function(r,e){p("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;p("opening %s",this.uri);this.engine=c(this.uri,this.opts);var t=this.engine;var n=this;this.readyState="opening";this.skipReconnect=false;var i=f(t,"open",function(){n.onopen();r&&r()});var o=f(t,"error",function(e){p("connect_error");n.cleanup();n.readyState="closed";n.emitAll("connect_error",e);if(r){var t=new Error("Connection error");t.data=e;r(t)}else{n.maybeReconnectOnOpen()}});if(false!==this._timeout){var a=this._timeout;p("connect attempt will timeout after %d",a);var s=setTimeout(function(){p("connect attempt timed out after %d",a);i.destroy();t.close();t.emit("error","timeout");n.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(s)}})}this.subs.push(i);this.subs.push(o);return this};l.prototype.onopen=function(){p("open");this.cleanup();this.readyState="open";this.emit("open");var e=this.engine;this.subs.push(f(e,"data",a(this,"ondata")));this.subs.push(f(e,"ping",a(this,"onping")));this.subs.push(f(e,"pong",a(this,"onpong")));this.subs.push(f(e,"error",a(this,"onerror")));this.subs.push(f(e,"close",a(this,"onclose")));this.subs.push(f(this.decoder,"decoded",a(this,"ondecoded")))};l.prototype.onping=function(){this.lastPing=new Date;this.emitAll("ping")};l.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)};l.prototype.ondata=function(e){this.decoder.add(e)};l.prototype.ondecoded=function(e){this.emit("packet",e)};l.prototype.onerror=function(e){p("error",e);this.emitAll("error",e)};l.prototype.socket=function(e,t){var r=this.nsps[e];if(!r){r=new o(this,e,t);this.nsps[e]=r;var n=this;r.on("connecting",i);r.on("connect",function(){r.id=n.generateId(e)});if(this.autoConnect){i()}}function i(){if(!~s(n.connecting,r)){n.connecting.push(r)}}return r};l.prototype.destroy=function(e){var t=s(this.connecting,e);if(~t)this.connecting.splice(t,1);if(this.connecting.length)return;this.close()};l.prototype.packet=function(r){p("writing packet %j",r);var n=this;if(r.query&&r.type===0)r.nsp+="?"+r.query;if(!n.encoding){n.encoding=true;this.encoder.encode(r,function(e){for(var t=0;t<e.length;t++){n.engine.write(e[t],r.options)}n.encoding=false;n.processPacketQueue()})}else{n.packetBuffer.push(r)}};l.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}};l.prototype.cleanup=function(){p("cleanup");var e=this.subs.length;for(var t=0;t<e;t++){var r=this.subs.shift();r.destroy()}this.packetBuffer=[];this.encoding=false;this.lastPing=null;this.decoder.destroy()};l.prototype.close=l.prototype.disconnect=function(){p("disconnect");this.skipReconnect=true;this.reconnecting=false;if("opening"===this.readyState){this.cleanup()}this.backoff.reset();this.readyState="closed";if(this.engine)this.engine.close()};l.prototype.onclose=function(e){p("onclose");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",e);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};l.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts){p("reconnect failed");this.backoff.reset();this.emitAll("reconnect_failed");this.reconnecting=false}else{var e=this.backoff.duration();p("will wait %dms before reconnect attempt",e);this.reconnecting=true;var r=setTimeout(function(){if(t.skipReconnect)return;p("attempting reconnect");t.emitAll("reconnect_attempt",t.backoff.attempts);t.emitAll("reconnecting",t.backoff.attempts);if(t.skipReconnect)return;t.open(function(e){if(e){p("reconnect attempt error");t.reconnecting=false;t.reconnect();t.emitAll("reconnect_error",e.data)}else{p("reconnect success");t.onreconnect()}})},e);this.subs.push({destroy:function(){clearTimeout(r)}})}};l.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",e)}},{"./on":36,"./socket":37,backo2:3,"component-bind":7,"component-emitter":8,debug:39,"engine.io-client":10,indexof:27,"socket.io-parser":42}],36:[function(e,t,r){t.exports=n;function n(e,t,r){e.on(t,r);return{destroy:function(){e.removeListener(t,r)}}}},{}],37:[function(e,t,r){var i=e("socket.io-parser");var n=e("component-emitter");var o=e("to-array");var a=e("./on");var s=e("component-bind");var c=e("debug")("socket.io-client:socket");var f=e("parseqs");var p=e("has-binary2");t.exports=r=l;var u={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1};var d=n.prototype.emit;function l(e,t,r){this.io=e;this.nsp=t;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true;this.flags={};if(r&&r.query){this.query=r.query}if(this.io.autoConnect)this.open()}n(l.prototype);l.prototype.subEvents=function(){if(this.subs)return;var e=this.io;this.subs=[a(e,"open",s(this,"onopen")),a(e,"packet",s(this,"onpacket")),a(e,"close",s(this,"onclose"))]};l.prototype.open=l.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"===this.io.readyState)this.onopen();this.emit("connecting");return this};l.prototype.send=function(){var e=o(arguments);e.unshift("message");this.emit.apply(this,e);return this};l.prototype.emit=function(e){if(u.hasOwnProperty(e)){d.apply(this,arguments);return this}var t=o(arguments);var r={type:(this.flags.binary!==undefined?this.flags.binary:p(t))?i.BINARY_EVENT:i.EVENT,data:t};r.options={};r.options.compress=!this.flags||false!==this.flags.compress;if("function"===typeof t[t.length-1]){c("emitting packet with ack id %d",this.ids);this.acks[this.ids]=t.pop();r.id=this.ids++}if(this.connected){this.packet(r)}else{this.sendBuffer.push(r)}this.flags={};return this};l.prototype.packet=function(e){e.nsp=this.nsp;this.io.packet(e)};l.prototype.onopen=function(){c("transport is open - connecting");if("/"!==this.nsp){if(this.query){var e=typeof this.query==="object"?f.encode(this.query):this.query;c("sending connect packet with query %s",e);this.packet({type:i.CONNECT,query:e})}else{this.packet({type:i.CONNECT})}}};l.prototype.onclose=function(e){c("close (%s)",e);this.connected=false;this.disconnected=true;delete this.id;this.emit("disconnect",e)};l.prototype.onpacket=function(e){if(e.nsp!==this.nsp)return;switch(e.type){case i.CONNECT:this.onconnect();break;case i.EVENT:this.onevent(e);break;case i.BINARY_EVENT:this.onevent(e);break;case i.ACK:this.onack(e);break;case i.BINARY_ACK:this.onack(e);break;case i.DISCONNECT:this.ondisconnect();break;case i.ERROR:this.emit("error",e.data);break}};l.prototype.onevent=function(e){var t=e.data||[];c("emitting event %j",t);if(null!=e.id){c("attaching ack callback to event");t.push(this.ack(e.id))}if(this.connected){d.apply(this,t)}else{this.receiveBuffer.push(t)}};l.prototype.ack=function(t){var r=this;var n=false;return function(){if(n)return;n=true;var e=o(arguments);c("sending ack %j",e);r.packet({type:p(e)?i.BINARY_ACK:i.ACK,id:t,data:e})}};l.prototype.onack=function(e){var t=this.acks[e.id];if("function"===typeof t){c("calling ack %s with %j",e.id,e.data);t.apply(this,e.data);delete this.acks[e.id]}else{c("bad ack %s",e.id)}};l.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit("connect");this.emitBuffered()};l.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++){d.apply(this,this.receiveBuffer[e])}this.receiveBuffer=[];for(e=0;e<this.sendBuffer.length;e++){this.packet(this.sendBuffer[e])}this.sendBuffer=[]};l.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};l.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++){this.subs[e].destroy()}this.subs=null}this.io.destroy(this)};l.prototype.close=l.prototype.disconnect=function(){if(this.connected){c("performing disconnect (%s)",this.nsp);this.packet({type:i.DISCONNECT})}this.destroy();if(this.connected){this.onclose("io client disconnect")}return this};l.prototype.compress=function(e){this.flags.compress=e;return this};l.prototype.binary=function(e){this.flags.binary=e;return this}},{"./on":36,"component-bind":7,"component-emitter":8,debug:39,"has-binary2":24,parseqs:29,"socket.io-parser":42,"to-array":47}],38:[function(t,r,e){(function(o){var a=t("parseuri");var s=t("debug")("socket.io-client:url");r.exports=e;function e(e,t){var r=e;t=t||o.location;if(null==e)e=t.protocol+"//"+t.host;if("string"===typeof e){if("/"===e.charAt(0)){if("/"===e.charAt(1)){e=t.protocol+e}else{e=t.host+e}}if(!/^(https?|wss?):\/\//.test(e)){s("protocol-less url %s",e);if("undefined"!==typeof t){e=t.protocol+"//"+e}else{e="https://"+e}}s("parse %s",e);r=a(e)}if(!r.port){if(/^(http|ws)$/.test(r.protocol)){r.port="80"}else if(/^(http|ws)s$/.test(r.protocol)){r.port="443"}}r.path=r.path||"/";var n=r.host.indexOf(":")!==-1;var i=n?"["+r.host+"]":r.host;r.id=r.protocol+"://"+i+":"+r.port;r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port);return r}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{debug:39,parseuri:30}],39:[function(e,t,r){arguments[4][19][0].apply(r,arguments)},{"./debug":40,_process:31,dup:19}],40:[function(e,t,r){arguments[4][20][0].apply(r,arguments)},{dup:20,ms:28}],41:[function(r,e,n){(function(e){var p=r("isarray");var u=r("./is-buffer");var t=Object.prototype.toString;var d=typeof e.Blob==="function"||t.call(e.Blob)==="[object BlobConstructor]";var l=typeof e.File==="function"||t.call(e.File)==="[object FileConstructor]";n.deconstructPacket=function(e){var t=[];var r=e.data;var n=e;n.data=a(r,t);n.attachments=t.length;return{packet:n,buffers:t}};function a(e,t){if(!e)return e;if(u(e)){var r={_placeholder:true,num:t.length};t.push(e);return r}else if(p(e)){var n=new Array(e.length);for(var i=0;i<e.length;i++){n[i]=a(e[i],t)}return n}else if(typeof e==="object"&&!(e instanceof Date)){var n={};for(var o in e){n[o]=a(e[o],t)}return n}return e}n.reconstructPacket=function(e,t){e.data=i(e.data,t);e.attachments=undefined;return e};function i(e,t){if(!e)return e;if(e&&e._placeholder){return t[e.num]}else if(p(e)){for(var r=0;r<e.length;r++){e[r]=i(e[r],t)}}else if(typeof e==="object"){for(var n in e){e[n]=i(e[n],t)}}return e}n.removeBlobs=function(e,a){function s(e,t,r){if(!e)return e;if(d&&e instanceof Blob||l&&e instanceof File){c++;var n=new FileReader;n.onload=function(){if(r){r[t]=this.result}else{f=this.result}if(!--c){a(f)}};n.readAsArrayBuffer(e)}else if(p(e)){for(var i=0;i<e.length;i++){s(e[i],i,e)}}else if(typeof e==="object"&&!u(e)){for(var o in e){s(e[o],o,e)}}}var c=0;var f=e;s(f);if(!c){a(f)}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./is-buffer":43,isarray:46}],42:[function(e,t,c){var f=e("debug")("socket.io-parser");var r=e("component-emitter");var o=e("./binary");var p=e("isarray");var n=e("./is-buffer");c.protocol=4;c.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"];c.CONNECT=0;c.DISCONNECT=1;c.EVENT=2;c.ACK=3;c.ERROR=4;c.BINARY_EVENT=5;c.BINARY_ACK=6;c.Encoder=i;c.Decoder=l;function i(){}var a=c.ERROR+'"encode error"';i.prototype.encode=function(e,t){f("encoding packet %j",e);if(c.BINARY_EVENT===e.type||c.BINARY_ACK===e.type){d(e,t)}else{var r=s(e);t([r])}};function s(e){var t=""+e.type;if(c.BINARY_EVENT===e.type||c.BINARY_ACK===e.type){t+=e.attachments+"-"}if(e.nsp&&"/"!==e.nsp){t+=e.nsp+","}if(null!=e.id){t+=e.id}if(null!=e.data){var r=u(e.data);if(r!==false){t+=r}else{return a}}f("encoded %j as %s",e,t);return t}function u(e){try{return JSON.stringify(e)}catch(e){return false}}function d(e,i){function t(e){var t=o.deconstructPacket(e);var r=s(t.packet);var n=t.buffers;n.unshift(r);i(n)}o.removeBlobs(e,t)}function l(){this.reconstructor=null}r(l.prototype);l.prototype.add=function(e){var t;if(typeof e==="string"){t=h(e);if(c.BINARY_EVENT===t.type||c.BINARY_ACK===t.type){this.reconstructor=new m(t);if(this.reconstructor.reconPack.attachments===0){this.emit("decoded",t)}}else{this.emit("decoded",t)}}else if(n(e)||e.base64){if(!this.reconstructor){throw new Error("got binary data when not reconstructing a packet")}else{t=this.reconstructor.takeBinaryData(e);if(t){this.reconstructor=null;this.emit("decoded",t)}}}else{throw new Error("Unknown type: "+e)}};function h(e){var t=0;var r={type:Number(e.charAt(0))};if(null==c.types[r.type]){return y("unknown packet type "+r.type)}if(c.BINARY_EVENT===r.type||c.BINARY_ACK===r.type){var n="";while(e.charAt(++t)!=="-"){n+=e.charAt(t);if(t==e.length)break}if(n!=Number(n)||e.charAt(t)!=="-"){throw new Error("Illegal attachments")}r.attachments=Number(n)}if("/"===e.charAt(t+1)){r.nsp="";while(++t){var i=e.charAt(t);if(","===i)break;r.nsp+=i;if(t===e.length)break}}else{r.nsp="/"}var o=e.charAt(t+1);if(""!==o&&Number(o)==o){r.id="";while(++t){var i=e.charAt(t);if(null==i||Number(i)!=i){--t;break}r.id+=e.charAt(t);if(t===e.length)break}r.id=Number(r.id)}if(e.charAt(++t)){var a=v(e.substr(t));var s=a!==false&&(r.type===c.ERROR||p(a));if(s){r.data=a}else{return y("invalid payload")}}f("decoded %s as %j",e,r);return r}function v(e){try{return JSON.parse(e)}catch(e){return false}}l.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function m(e){this.reconPack=e;this.buffers=[]}m.prototype.takeBinaryData=function(e){this.buffers.push(e);if(this.buffers.length===this.reconPack.attachments){var t=o.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return t}return null};m.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function y(e){return{type:c.ERROR,data:"parser error: "+e}}},{"./binary":41,"./is-buffer":43,"component-emitter":8,debug:44,isarray:46}],43:[function(e,o,t){(function(t){o.exports=e;var r=typeof t.Buffer==="function"&&typeof t.Buffer.isBuffer==="function";var n=typeof t.ArrayBuffer==="function";var i=function(){if(n&&typeof t.ArrayBuffer.isView==="function"){return t.ArrayBuffer.isView}else{return function(e){return e.buffer instanceof t.ArrayBuffer}}}();function e(e){return r&&t.Buffer.isBuffer(e)||n&&(e instanceof t.ArrayBuffer||i(e))}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],44:[function(e,t,r){arguments[4][19][0].apply(r,arguments)},{"./debug":45,_process:31,dup:19}],45:[function(e,t,r){arguments[4][20][0].apply(r,arguments)},{dup:20,ms:28}],46:[function(e,t,r){arguments[4][25][0].apply(r,arguments)},{dup:25}],47:[function(e,t,r){t.exports=n;function n(e,t){var r=[];t=t||0;for(var n=t||0;n<e.length;n++){r[n-t]=e[n]}return r}},{}],48:[function(r,n,e){(function(e){"use strict";var t=r("./adapter_factory.js");n.exports=t({window:e.window})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./adapter_factory.js":49}],49:[function(l,e,t){"use strict";var h=l("./utils");e.exports=function(e,t){var r=e&&e.window;var n={shimChrome:true,shimFirefox:true,shimEdge:true,shimSafari:true};for(var i in t){if(hasOwnProperty.call(t,i)){n[i]=t[i]}}var o=h.log;var a=h.detectBrowser(r);var s=l("./chrome/chrome_shim")||null;var c=l("./edge/edge_shim")||null;var f=l("./firefox/firefox_shim")||null;var p=l("./safari/safari_shim")||null;var u=l("./common_shim")||null;var d={browserDetails:a,commonShim:u,extractVersion:h.extractVersion,disableLog:h.disableLog,disableWarnings:h.disableWarnings};switch(a.browser){case"chrome":if(!s||!s.shimPeerConnection||!n.shimChrome){o("Chrome shim is not included in this adapter release.");return d}o("adapter.js shimming chrome.");d.browserShim=s;u.shimCreateObjectURL(r);s.shimGetUserMedia(r);s.shimMediaStream(r);s.shimSourceObject(r);s.shimPeerConnection(r);s.shimOnTrack(r);s.shimAddTrackRemoveTrack(r);s.shimGetSendersWithDtmf(r);u.shimRTCIceCandidate(r);u.shimMaxMessageSize(r);u.shimSendThrowTypeError(r);break;case"firefox":if(!f||!f.shimPeerConnection||!n.shimFirefox){o("Firefox shim is not included in this adapter release.");return d}o("adapter.js shimming firefox.");d.browserShim=f;u.shimCreateObjectURL(r);f.shimGetUserMedia(r);f.shimSourceObject(r);f.shimPeerConnection(r);f.shimOnTrack(r);f.shimRemoveStream(r);u.shimRTCIceCandidate(r);u.shimMaxMessageSize(r);u.shimSendThrowTypeError(r);break;case"edge":if(!c||!c.shimPeerConnection||!n.shimEdge){o("MS edge shim is not included in this adapter release.");return d}o("adapter.js shimming edge.");d.browserShim=c;u.shimCreateObjectURL(r);c.shimGetUserMedia(r);c.shimPeerConnection(r);c.shimReplaceTrack(r);u.shimMaxMessageSize(r);u.shimSendThrowTypeError(r);break;case"safari":if(!p||!n.shimSafari){o("Safari shim is not included in this adapter release.");return d}o("adapter.js shimming safari.");d.browserShim=p;u.shimCreateObjectURL(r);p.shimRTCIceServerUrls(r);p.shimCallbacksAPI(r);p.shimLocalStreamsAPI(r);p.shimRemoteStreamsAPI(r);p.shimTrackEventTransceiver(r);p.shimGetUserMedia(r);p.shimCreateOfferLegacy(r);u.shimRTCIceCandidate(r);u.shimMaxMessageSize(r);u.shimSendThrowTypeError(r);break;default:o("Unsupported browser!");break}return d}},{"./chrome/chrome_shim":50,"./common_shim":52,"./edge/edge_shim":53,"./firefox/firefox_shim":55,"./safari/safari_shim":57,"./utils":58}],50:[function(e,t,r){"use strict";var f=e("../utils.js");var n=f.log;t.exports={shimGetUserMedia:e("./getusermedia"),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(o){if(typeof o==="object"&&o.RTCPeerConnection&&!("ontrack"in o.RTCPeerConnection.prototype)){Object.defineProperty(o.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){if(this._ontrack){this.removeEventListener("track",this._ontrack)}this.addEventListener("track",this._ontrack=e)}});var e=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){var i=this;if(!i._ontrackpoly){i._ontrackpoly=function(n){n.stream.addEventListener("addtrack",function(t){var e;if(o.RTCPeerConnection.prototype.getReceivers){e=i.getReceivers().find(function(e){return e.track&&e.track.id===t.track.id})}else{e={track:t.track}}var r=new Event("track");r.track=t.track;r.receiver=e;r.transceiver={receiver:e};r.streams=[n.stream];i.dispatchEvent(r)});n.stream.getTracks().forEach(function(t){var e;if(o.RTCPeerConnection.prototype.getReceivers){e=i.getReceivers().find(function(e){return e.track&&e.track.id===t.id})}else{e={track:t}}var r=new Event("track");r.track=t;r.receiver=e;r.transceiver={receiver:e};r.streams=[n.stream];i.dispatchEvent(r)})};i.addEventListener("addstream",i._ontrackpoly)}return e.apply(i,arguments)}}else if(!("RTCRtpTransceiver"in o)){f.wrapPeerConnectionEvent(o,"track",function(e){if(!e.transceiver){e.transceiver={receiver:e.receiver}}return e})}},shimGetSendersWithDtmf:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var i=function(e,t){return{track:t,get dtmf(){if(this._dtmf===undefined){if(t.kind==="audio"){this._dtmf=e.createDTMFSender(t)}else{this._dtmf=null}}return this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){this._senders=this._senders||[];return this._senders.slice()};var o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,t){var r=this;var n=o.apply(r,arguments);if(!n){n=i(r,e);r._senders.push(n)}return n};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;n.apply(t,arguments);var r=t._senders.indexOf(e);if(r!==-1){t._senders.splice(r,1)}}}var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;t._senders=t._senders||[];r.apply(t,[e]);e.getTracks().forEach(function(e){t._senders.push(i(t,e))})};var t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var r=this;r._senders=r._senders||[];t.apply(r,[e]);e.getTracks().forEach(function(t){var e=r._senders.find(function(e){return e.track===t});if(e){r._senders.splice(r._senders.indexOf(e),1)}})}}else if(typeof e==="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var t=this;var e=a.apply(t,[]);e.forEach(function(e){e._pc=t});return e};Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){if(this._dtmf===undefined){if(this.track.kind==="audio"){this._dtmf=this._pc.createDTMFSender(this.track)}else{this._dtmf=null}}return this._dtmf}})}},shimSourceObject:function(e){var r=e&&e.URL;if(typeof e==="object"){if(e.HTMLMediaElement&&!("srcObject"in e.HTMLMediaElement.prototype)){Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;this._srcObject=e;if(this.src){r.revokeObjectURL(this.src)}if(!e){this.src="";return undefined}this.src=r.createObjectURL(e);e.addEventListener("addtrack",function(){if(t.src){r.revokeObjectURL(t.src)}t.src=r.createObjectURL(e)});e.addEventListener("removetrack",function(){if(t.src){r.revokeObjectURL(t.src)}t.src=r.createObjectURL(e)})}})}}},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};return Object.keys(this._shimmedLocalStreams).map(function(e){return t._shimmedLocalStreams[e][0]})};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,t){if(!t){return n.apply(this,arguments)}this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=n.apply(this,arguments);if(!this._shimmedLocalStreams[t.id]){this._shimmedLocalStreams[t.id]=[t,r]}else if(this._shimmedLocalStreams[t.id].indexOf(r)===-1){this._shimmedLocalStreams[t.id].push(r)}return r};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};e.getTracks().forEach(function(t){var e=r.getSenders().find(function(e){return e.track===t});if(e){throw new DOMException("Track already exists.","InvalidAccessError")}});var t=r.getSenders();i.apply(this,arguments);var n=r.getSenders().filter(function(e){return t.indexOf(e)===-1});this._shimmedLocalStreams[e.id]=[e].concat(n)};var t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{};delete this._shimmedLocalStreams[e.id];return t.apply(this,arguments)};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(r){var n=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};if(r){Object.keys(this._shimmedLocalStreams).forEach(function(e){var t=n._shimmedLocalStreams[e].indexOf(r);if(t!==-1){n._shimmedLocalStreams[e].splice(t,1)}if(n._shimmedLocalStreams[e].length===1){delete n._shimmedLocalStreams[e]}})}return o.apply(this,arguments)}},shimAddTrackRemoveTrack:function(s){var e=f.detectBrowser(s);if(s.RTCPeerConnection.prototype.addTrack&&e.version>=65){return this.shimAddTrackRemoveTrackWithNative(s)}var r=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this;var e=r.apply(this);t._reverseStreams=t._reverseStreams||{};return e.map(function(e){return t._reverseStreams[e.id]})};var n=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(e){var r=this;r._streams=r._streams||{};r._reverseStreams=r._reverseStreams||{};e.getTracks().forEach(function(t){var e=r.getSenders().find(function(e){return e.track===t});if(e){throw new DOMException("Track already exists.","InvalidAccessError")}});if(!r._reverseStreams[e.id]){var t=new s.MediaStream(e.getTracks());r._streams[e.id]=t;r._reverseStreams[t.id]=e;e=t}n.apply(r,[e])};var i=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{};t._reverseStreams=t._reverseStreams||{};i.apply(t,[t._streams[e.id]||e]);delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id];delete t._streams[e.id]};s.RTCPeerConnection.prototype.addTrack=function(t,e){var r=this;if(r.signalingState==="closed"){throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError")}var n=[].slice.call(arguments,1);if(n.length!==1||!n[0].getTracks().find(function(e){return e===t})){throw new DOMException("The adapter.js addTrack polyfill only supports a single "+" stream which is associated with the specified track.","NotSupportedError")}var i=r.getSenders().find(function(e){return e.track===t});if(i){throw new DOMException("Track already exists.","InvalidAccessError")}r._streams=r._streams||{};r._reverseStreams=r._reverseStreams||{};var o=r._streams[e.id];if(o){o.addTrack(t);Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))})}else{var a=new s.MediaStream([t]);r._streams[e.id]=a;r._reverseStreams[a.id]=e;r.addStream(a)}return r.getSenders().find(function(e){return e.track===t})};function o(n,e){var i=e.sdp;Object.keys(n._reverseStreams||[]).forEach(function(e){var t=n._reverseStreams[e];var r=n._streams[t.id];i=i.replace(new RegExp(r.id,"g"),t.id)});return new RTCSessionDescription({type:e.type,sdp:i})}function t(n,e){var i=e.sdp;Object.keys(n._reverseStreams||[]).forEach(function(e){var t=n._reverseStreams[e];var r=n._streams[t.id];i=i.replace(new RegExp(t.id,"g"),r.id)});return new RTCSessionDescription({type:e.type,sdp:i})}["createOffer","createAnswer"].forEach(function(e){var t=s.RTCPeerConnection.prototype[e];s.RTCPeerConnection.prototype[e]=function(){var r=this;var n=arguments;var e=arguments.length&&typeof arguments[0]==="function";if(e){return t.apply(r,[function(e){var t=o(r,e);n[0].apply(null,[t])},function(e){if(n[1]){n[1].apply(null,e)}},arguments[2]])}return t.apply(r,arguments).then(function(e){return o(r,e)})}});var a=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;if(!arguments.length||!arguments[0].type){return a.apply(e,arguments)}arguments[0]=t(e,arguments[0]);return a.apply(e,arguments)};var c=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=this;var t=c.get.apply(this);if(t.type===""){return t}return o(e,t)}});s.RTCPeerConnection.prototype.removeTrack=function(r){var n=this;if(n.signalingState==="closed"){throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError")}if(!r._pc){throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack "+"does not implement interface RTCRtpSender.","TypeError")}var e=r._pc===n;if(!e){throw new DOMException("Sender was not created by this connection.","InvalidAccessError")}n._streams=n._streams||{};var i;Object.keys(n._streams).forEach(function(e){var t=n._streams[e].getTracks().find(function(e){return r.track===e});if(t){i=n._streams[e]}});if(i){if(i.getTracks().length===1){n.removeStream(n._reverseStreams[i.id])}else{i.removeTrack(r.track)}n.dispatchEvent(new Event("negotiationneeded"))}}},shimPeerConnection:function(r){var e=f.detectBrowser(r);if(!r.RTCPeerConnection&&r.webkitRTCPeerConnection){r.RTCPeerConnection=function(e,t){n("PeerConnection");if(e&&e.iceTransportPolicy){e.iceTransports=e.iceTransportPolicy}return new r.webkitRTCPeerConnection(e,t)};r.RTCPeerConnection.prototype=r.webkitRTCPeerConnection.prototype;if(r.webkitRTCPeerConnection.generateCertificate){Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get:function(){return r.webkitRTCPeerConnection.generateCertificate}})}}else{var o=r.RTCPeerConnection;r.RTCPeerConnection=function(e,t){if(e&&e.iceServers){var r=[];for(var n=0;n<e.iceServers.length;n++){var i=e.iceServers[n];if(!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")){f.deprecated("RTCIceServer.url","RTCIceServer.urls");i=JSON.parse(JSON.stringify(i));i.urls=i.url;r.push(i)}else{r.push(e.iceServers[n])}}e.iceServers=r}return new o(e,t)};r.RTCPeerConnection.prototype=o.prototype;Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get:function(){return o.generateCertificate}})}var c=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(e,t,r){var n=this;var i=arguments;if(arguments.length>0&&typeof e==="function"){return c.apply(this,arguments)}if(c.length===0&&(arguments.length===0||typeof arguments[0]!=="function")){return c.apply(this,[])}var o=function(e){var n={};var t=e.result();t.forEach(function(t){var r={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach(function(e){r[e]=t.stat(e)});n[r.id]=r});return n};var a=function(t){return new Map(Object.keys(t).map(function(e){return[e,t[e]]}))};if(arguments.length>=2){var s=function(e){i[1](a(o(e)))};return c.apply(this,[s,arguments[0]])}return new Promise(function(t,e){c.apply(n,[function(e){t(a(o(e)))},e])}).then(t,r)};if(e.version<51){["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var i=r.RTCPeerConnection.prototype[e];r.RTCPeerConnection.prototype[e]=function(){var r=arguments;var n=this;var e=new Promise(function(e,t){i.apply(n,[r[0],e,t])});if(r.length<2){return e}return e.then(function(){r[1].apply(null,[])},function(e){if(r.length>=3){r[2].apply(null,[e])}})}})}if(e.version<52){["createOffer","createAnswer"].forEach(function(e){var i=r.RTCPeerConnection.prototype[e];r.RTCPeerConnection.prototype[e]=function(){var r=this;if(arguments.length<1||arguments.length===1&&typeof arguments[0]==="object"){var n=arguments.length===1?arguments[0]:undefined;return new Promise(function(e,t){i.apply(r,[e,t,n])})}return i.apply(this,arguments)}})}["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=r.RTCPeerConnection.prototype[e];r.RTCPeerConnection.prototype[e]=function(){arguments[0]=new(e==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]);return t.apply(this,arguments)}});var t=r.RTCPeerConnection.prototype.addIceCandidate;r.RTCPeerConnection.prototype.addIceCandidate=function(){if(!arguments[0]){if(arguments[1]){arguments[1].apply(null)}return Promise.resolve()}return t.apply(this,arguments)}}}},{"../utils.js":58,"./getusermedia":51}],51:[function(e,t,r){"use strict";var f=e("../utils.js");var p=f.log;t.exports=function(e){var a=f.detectBrowser(e);var s=e&&e.navigator;var c=function(i){if(typeof i!=="object"||i.mandatory||i.optional){return i}var o={};Object.keys(i).forEach(function(t){if(t==="require"||t==="advanced"||t==="mediaSource"){return}var r=typeof i[t]==="object"?i[t]:{ideal:i[t]};if(r.exact!==undefined&&typeof r.exact==="number"){r.min=r.max=r.exact}var n=function(e,t){if(e){return e+t.charAt(0).toUpperCase()+t.slice(1)}return t==="deviceId"?"sourceId":t};if(r.ideal!==undefined){o.optional=o.optional||[];var e={};if(typeof r.ideal==="number"){e[n("min",t)]=r.ideal;o.optional.push(e);e={};e[n("max",t)]=r.ideal;o.optional.push(e)}else{e[n("",t)]=r.ideal;o.optional.push(e)}}if(r.exact!==undefined&&typeof r.exact!=="number"){o.mandatory=o.mandatory||{};o.mandatory[n("",t)]=r.exact}else{["min","max"].forEach(function(e){if(r[e]!==undefined){o.mandatory=o.mandatory||{};o.mandatory[n(e,t)]=r[e]}})}});if(i.advanced){o.optional=(o.optional||[]).concat(i.advanced)}return o};var n=function(r,n){if(a.version>=61){return n(r)}r=JSON.parse(JSON.stringify(r));if(r&&typeof r.audio==="object"){var e=function(e,t,r){if(t in e&&!(r in e)){e[r]=e[t];delete e[t]}};r=JSON.parse(JSON.stringify(r));e(r.audio,"autoGainControl","googAutoGainControl");e(r.audio,"noiseSuppression","googNoiseSuppression");r.audio=c(r.audio)}if(r&&typeof r.video==="object"){var i=r.video.facingMode;i=i&&(typeof i==="object"?i:{ideal:i});var t=a.version<66;if(i&&(i.exact==="user"||i.exact==="environment"||i.ideal==="user"||i.ideal==="environment")&&!(s.mediaDevices.getSupportedConstraints&&s.mediaDevices.getSupportedConstraints().facingMode&&!t)){delete r.video.facingMode;var o;if(i.exact==="environment"||i.ideal==="environment"){o=["back","rear"]}else if(i.exact==="user"||i.ideal==="user"){o=["front"]}if(o){return s.mediaDevices.enumerateDevices().then(function(e){e=e.filter(function(e){return e.kind==="videoinput"});var t=e.find(function(t){return o.some(function(e){return t.label.toLowerCase().indexOf(e)!==-1})});if(!t&&e.length&&o.indexOf("back")!==-1){t=e[e.length-1]}if(t){r.video.deviceId=i.exact?{exact:t.deviceId}:{ideal:t.deviceId}}r.video=c(r.video);p("chrome: "+JSON.stringify(r));return n(r)})}}r.video=c(r.video)}p("chrome: "+JSON.stringify(r));return n(r)};var i=function(e){return{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};var t=function(e,t,r){n(e,function(e){s.webkitGetUserMedia(e,t,function(e){if(r){r(i(e))}})})};s.getUserMedia=t;var r=function(r){return new Promise(function(e,t){s.getUserMedia(r,e,t)})};if(!s.mediaDevices){s.mediaDevices={getUserMedia:r,enumerateDevices:function(){return new Promise(function(t){var r={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:r[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:true,echoCancellation:true,facingMode:true,frameRate:true,height:true,width:true}}}}if(!s.mediaDevices.getUserMedia){s.mediaDevices.getUserMedia=function(e){return r(e)}}else{var o=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(e){return n(e,function(t){return o(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length){e.getTracks().forEach(function(e){e.stop()});throw new DOMException("","NotFoundError")}return e},function(e){return Promise.reject(i(e))})})}}if(typeof s.mediaDevices.addEventListener==="undefined"){s.mediaDevices.addEventListener=function(){p("Dummy mediaDevices.addEventListener called.")}}if(typeof s.mediaDevices.removeEventListener==="undefined"){s.mediaDevices.removeEventListener=function(){p("Dummy mediaDevices.removeEventListener called.")}}}},{"../utils.js":58}],52:[function(e,t,r){"use strict";var o=e("sdp");var u=e("./utils");t.exports={shimRTCIceCandidate:function(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype){return}var i=t.RTCIceCandidate;t.RTCIceCandidate=function(e){if(typeof e==="object"&&e.candidate&&e.candidate.indexOf("a=")===0){e=JSON.parse(JSON.stringify(e));e.candidate=e.candidate.substr(2)}if(e.candidate&&e.candidate.length){var t=new i(e);var r=o.parseCandidate(e.candidate);var n=Object.assign(t,r);n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}};return n}return new i(e)};t.RTCIceCandidate.prototype=i.prototype;u.wrapPeerConnectionEvent(t,"icecandidate",function(e){if(e.candidate){Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"})}return e})},shimCreateObjectURL:function(e){var t=e&&e.URL;if(!(typeof e==="object"&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL)){return undefined}var r=t.createObjectURL.bind(t);var n=t.revokeObjectURL.bind(t);var i=new Map,o=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++o;i.set(t,e);u.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream");return t}return r(e)};t.revokeObjectURL=function(e){n(e);i.delete(e)};var a=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return a.get.apply(this)},set:function(e){this.srcObject=i.get(e)||null;return a.set.apply(this,[e])}});var s=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){if(arguments.length===2&&(""+arguments[0]).toLowerCase()==="src"){this.srcObject=i.get(arguments[1])||null}return s.apply(this,arguments)}},shimMaxMessageSize:function(e){if(e.RTCSctpTransport||!e.RTCPeerConnection){return}var i=u.detectBrowser(e);if(!("sctp"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return typeof this._sctp==="undefined"?null:this._sctp}})}var a=function(e){var t=o.splitSections(e.sdp);t.shift();return t.some(function(e){var t=o.parseMLine(e);return t&&t.kind==="application"&&t.protocol.indexOf("SCTP")!==-1})};var s=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(t===null||t.length<2){return-1}var r=parseInt(t[1],10);return r!==r?-1:r};var c=function(e){var t=65536;if(i.browser==="firefox"){if(i.version<57){if(e===-1){t=16384}else{t=2147483637}}else{t=i.version===57?65535:65536}}return t};var f=function(e,t){var r=65536;if(i.browser==="firefox"&&i.version===57){r=65535}var n=o.matchPrefix(e.sdp,"a=max-message-size:");if(n.length>0){r=parseInt(n[0].substr(19),10)}else if(i.browser==="firefox"&&t!==-1){r=2147483637}return r};var p=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;e._sctp=null;if(a(arguments[0])){var t=s(arguments[0]);var r=c(t);var n=f(arguments[0],t);var i;if(r===0&&n===0){i=Number.POSITIVE_INFINITY}else if(r===0||n===0){i=Math.max(r,n)}else{i=Math.min(r,n)}var o={};Object.defineProperty(o,"maxMessageSize",{get:function(){return i}});e._sctp=o}return p.apply(e,arguments)}},shimSendThrowTypeError:function(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype)){return}var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var n=this;var e=t.apply(n,arguments);var i=e.send;e.send=function(){var e=this;var t=arguments[0];var r=t.length||t.size||t.byteLength;if(r>n.sctp.maxMessageSize){throw new DOMException("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)","TypeError")}return i.apply(e,arguments)};return e}}}},{"./utils":58,sdp:33}],53:[function(e,t,r){"use strict";var n=e("../utils");var i=e("rtcpeerconnection-shim");t.exports={shimGetUserMedia:e("./getusermedia"),shimPeerConnection:function(e){var t=n.detectBrowser(e);if(e.RTCIceGatherer){if(!e.RTCIceCandidate){e.RTCIceCandidate=function(e){return e}}if(!e.RTCSessionDescription){e.RTCSessionDescription=function(e){return e}}if(t.version<15025){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e;this.dispatchEvent(t)}})}}if(e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){if(this._dtmf===undefined){if(this.track.kind==="audio"){this._dtmf=new e.RTCDtmfSender(this)}else if(this.track.kind==="video"){this._dtmf=null}}return this._dtmf}})}if(e.RTCDtmfSender&&!e.RTCDTMFSender){e.RTCDTMFSender=e.RTCDtmfSender}e.RTCPeerConnection=i(e,t.version)},shimReplaceTrack:function(e){if(e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)){e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack}}}},{"../utils":58,"./getusermedia":54,"rtcpeerconnection-shim":32}],54:[function(e,t,r){"use strict";t.exports=function(e){var t=e&&e.navigator;var r=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}};var n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(function(e){return Promise.reject(r(e))})}}},{}],55:[function(e,t,r){"use strict";var a=e("../utils");t.exports={shimGetUserMedia:e("./getusermedia"),shimOnTrack:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){if(this._ontrack){this.removeEventListener("track",this._ontrack);this.removeEventListener("addstream",this._ontrackpoly)}this.addEventListener("track",this._ontrack=e);this.addEventListener("addstream",this._ontrackpoly=function(r){r.stream.getTracks().forEach(function(e){var t=new Event("track");t.track=e;t.receiver={track:e};t.transceiver={receiver:t.receiver};t.streams=[r.stream];this.dispatchEvent(t)}.bind(this))}.bind(this))}})}if(typeof e==="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)){Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}},shimSourceObject:function(e){if(typeof e==="object"){if(e.HTMLMediaElement&&!("srcObject"in e.HTMLMediaElement.prototype)){Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}})}}},shimPeerConnection:function(s){var c=a.detectBrowser(s);if(typeof s!=="object"||!(s.RTCPeerConnection||s.mozRTCPeerConnection)){return}if(!s.RTCPeerConnection){s.RTCPeerConnection=function(e,t){if(c.version<38){if(e&&e.iceServers){var r=[];for(var n=0;n<e.iceServers.length;n++){var i=e.iceServers[n];if(i.hasOwnProperty("urls")){for(var o=0;o<i.urls.length;o++){var a={url:i.urls[o]};if(i.urls[o].indexOf("turn")===0){a.username=i.username;a.credential=i.credential}r.push(a)}}else{r.push(e.iceServers[n])}}e.iceServers=r}}return new s.mozRTCPeerConnection(e,t)};s.RTCPeerConnection.prototype=s.mozRTCPeerConnection.prototype;if(s.mozRTCPeerConnection.generateCertificate){Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get:function(){return s.mozRTCPeerConnection.generateCertificate}})}s.RTCSessionDescription=s.mozRTCSessionDescription;s.RTCIceCandidate=s.mozRTCIceCandidate}["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=s.RTCPeerConnection.prototype[e];s.RTCPeerConnection.prototype[e]=function(){arguments[0]=new(e==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]);return t.apply(this,arguments)}});var e=s.RTCPeerConnection.prototype.addIceCandidate;s.RTCPeerConnection.prototype.addIceCandidate=function(){if(!arguments[0]){if(arguments[1]){arguments[1].apply(null)}return Promise.resolve()}return e.apply(this,arguments)};var n=function(t){var r=new Map;Object.keys(t).forEach(function(e){r.set(e,t[e]);r[e]=t[e]});return r};var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"};var o=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(e,t,r){return o.apply(this,[e||null]).then(function(r){if(c.version<48){r=n(r)}if(c.version<53&&!t){try{r.forEach(function(e){e.type=i[e.type]||e.type})}catch(e){if(e.name!=="TypeError"){throw e}r.forEach(function(e,t){r.set(t,Object.assign({},e,{type:i[e.type]||e.type}))})}}return r}).then(t,r)}},shimRemoveStream:function(e){if(!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype){return}e.RTCPeerConnection.prototype.removeStream=function(t){var r=this;a.deprecated("removeStream","removeTrack");this.getSenders().forEach(function(e){if(e.track&&t.getTracks().indexOf(e.track)!==-1){r.removeTrack(e)}})}}}},{"../utils":58,"./getusermedia":56}],56:[function(e,t,r){"use strict";var l=e("../utils");var h=l.log;t.exports=function(e){var i=l.detectBrowser(e);var o=e&&e.navigator;var t=e&&e.MediaStreamTrack;var a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the "+"user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}};var n=function(e,t,r){var n=function(n){if(typeof n!=="object"||n.require){return n}var i=[];Object.keys(n).forEach(function(e){if(e==="require"||e==="advanced"||e==="mediaSource"){return}var t=n[e]=typeof n[e]==="object"?n[e]:{ideal:n[e]};if(t.min!==undefined||t.max!==undefined||t.exact!==undefined){i.push(e)}if(t.exact!==undefined){if(typeof t.exact==="number"){t.min=t.max=t.exact}else{n[e]=t.exact}delete t.exact}if(t.ideal!==undefined){n.advanced=n.advanced||[];var r={};if(typeof t.ideal==="number"){r[e]={min:t.ideal,max:t.ideal}}else{r[e]=t.ideal}n.advanced.push(r);delete t.ideal;if(!Object.keys(t).length){delete n[e]}}});if(i.length){n.require=i}return n};e=JSON.parse(JSON.stringify(e));if(i.version<38){h("spec: "+JSON.stringify(e));if(e.audio){e.audio=n(e.audio)}if(e.video){e.video=n(e.video)}h("ff37: "+JSON.stringify(e))}return o.mozGetUserMedia(e,t,function(e){r(a(e))})};var r=function(r){return new Promise(function(e,t){n(r,e,t)})};if(!o.mediaDevices){o.mediaDevices={getUserMedia:r,addEventListener:function(){},removeEventListener:function(){}}}o.mediaDevices.enumerateDevices=o.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})};if(i.version<41){var s=o.mediaDevices.enumerateDevices.bind(o.mediaDevices);o.mediaDevices.enumerateDevices=function(){return s().then(undefined,function(e){if(e.name==="NotFoundError"){return[]}throw e})}}if(i.version<49){var c=o.mediaDevices.getUserMedia.bind(o.mediaDevices);o.mediaDevices.getUserMedia=function(t){return c(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length){e.getTracks().forEach(function(e){e.stop()});throw new DOMException("The object can not be found here.","NotFoundError")}return e},function(e){return Promise.reject(a(e))})}}if(!(i.version>55&&"autoGainControl"in o.mediaDevices.getSupportedConstraints())){var f=function(e,t,r){if(t in e&&!(r in e)){e[r]=e[t];delete e[t]}};var p=o.mediaDevices.getUserMedia.bind(o.mediaDevices);o.mediaDevices.getUserMedia=function(e){if(typeof e==="object"&&typeof e.audio==="object"){e=JSON.parse(JSON.stringify(e));f(e.audio,"autoGainControl","mozAutoGainControl");f(e.audio,"noiseSuppression","mozNoiseSuppression")}return p(e)};if(t&&t.prototype.getSettings){var u=t.prototype.getSettings;t.prototype.getSettings=function(){var e=u.apply(this,arguments);f(e,"mozAutoGainControl","autoGainControl");f(e,"mozNoiseSuppression","noiseSuppression");return e}}if(t&&t.prototype.applyConstraints){var d=t.prototype.applyConstraints;t.prototype.applyConstraints=function(e){if(this.kind==="audio"&&typeof e==="object"){e=JSON.parse(JSON.stringify(e));f(e,"autoGainControl","mozAutoGainControl");f(e,"noiseSuppression","mozNoiseSuppression")}return d.apply(this,[e])}}}o.getUserMedia=function(e,t,r){if(i.version<44){return n(e,t,r)}l.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");o.mediaDevices.getUserMedia(e).then(t,r)}}},{"../utils":58}],57:[function(e,t,r){"use strict";var a=e("../utils");t.exports={shimLocalStreamsAPI:function(e){if(typeof e!=="object"||!e.RTCPeerConnection){return}if(!("getLocalStreams"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.getLocalStreams=function(){if(!this._localStreams){this._localStreams=[]}return this._localStreams}}if(!("getStreamById"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.getStreamById=function(t){var r=null;if(this._localStreams){this._localStreams.forEach(function(e){if(e.id===t){r=e}})}if(this._remoteStreams){this._remoteStreams.forEach(function(e){if(e.id===t){r=e}})}return r}}if(!("addStream"in e.RTCPeerConnection.prototype)){var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(t){if(!this._localStreams){this._localStreams=[]}if(this._localStreams.indexOf(t)===-1){this._localStreams.push(t)}var r=this;t.getTracks().forEach(function(e){n.call(r,e,t)})};e.RTCPeerConnection.prototype.addTrack=function(e,t){if(t){if(!this._localStreams){this._localStreams=[t]}else if(this._localStreams.indexOf(t)===-1){this._localStreams.push(t)}}return n.call(this,e,t)}}if(!("removeStream"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.removeStream=function(e){if(!this._localStreams){this._localStreams=[]}var t=this._localStreams.indexOf(e);if(t===-1){return}this._localStreams.splice(t,1);var r=this;var n=e.getTracks();this.getSenders().forEach(function(e){if(n.indexOf(e.track)!==-1){r.removeTrack(e)}})}}},shimRemoteStreamsAPI:function(e){if(typeof e!=="object"||!e.RTCPeerConnection){return}if(!("getRemoteStreams"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}}if(!("onaddstream"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var r=this;if(this._onaddstream){this.removeEventListener("addstream",this._onaddstream);this.removeEventListener("track",this._onaddstreampoly)}this.addEventListener("addstream",this._onaddstream=e);this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(!r._remoteStreams){r._remoteStreams=[]}if(r._remoteStreams.indexOf(e)>=0){return}r._remoteStreams.push(e);var t=new Event("addstream");t.stream=e;r.dispatchEvent(t)})})}})}},shimCallbacksAPI:function(e){if(typeof e!=="object"||!e.RTCPeerConnection){return}var t=e.RTCPeerConnection.prototype;var i=t.createOffer;var o=t.createAnswer;var a=t.setLocalDescription;var s=t.setRemoteDescription;var c=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0];var n=i.apply(this,[r]);if(!t){return n}n.then(e,t);return Promise.resolve()};t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0];var n=o.apply(this,[r]);if(!t){return n}n.then(e,t);return Promise.resolve()};var r=function(e,t,r){var n=a.apply(this,[e]);if(!r){return n}n.then(t,r);return Promise.resolve()};t.setLocalDescription=r;r=function(e,t,r){var n=s.apply(this,[e]);if(!r){return n}n.then(t,r);return Promise.resolve()};t.setRemoteDescription=r;r=function(e,t,r){var n=c.apply(this,[e]);if(!r){return n}n.then(t,r);return Promise.resolve()};t.addIceCandidate=r},shimGetUserMedia:function(e){var n=e&&e.navigator;if(!n.getUserMedia){if(n.webkitGetUserMedia){n.getUserMedia=n.webkitGetUserMedia.bind(n)}else if(n.mediaDevices&&n.mediaDevices.getUserMedia){n.getUserMedia=function(e,t,r){n.mediaDevices.getUserMedia(e).then(t,r)}.bind(n)}}},shimRTCIceServerUrls:function(e){var o=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){var r=[];for(var n=0;n<e.iceServers.length;n++){var i=e.iceServers[n];if(!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")){a.deprecated("RTCIceServer.url","RTCIceServer.urls");i=JSON.parse(JSON.stringify(i));i.urls=i.url;delete i.url;r.push(i)}else{r.push(e.iceServers[n])}}e.iceServers=r}return new o(e,t)};e.RTCPeerConnection.prototype=o.prototype;if("generateCertificate"in e.RTCPeerConnection){Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return o.generateCertificate}})}},shimTrackEventTransceiver:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver){Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}},shimCreateOfferLegacy:function(e){var i=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var t=this;if(e){if(typeof e.offerToReceiveAudio!=="undefined"){e.offerToReceiveAudio=!!e.offerToReceiveAudio}var r=t.getTransceivers().find(function(e){return e.sender.track&&e.sender.track.kind==="audio"});if(e.offerToReceiveAudio===false&&r){if(r.direction==="sendrecv"){if(r.setDirection){r.setDirection("sendonly")}else{r.direction="sendonly"}}else if(r.direction==="recvonly"){if(r.setDirection){r.setDirection("inactive")}else{r.direction="inactive"}}}else if(e.offerToReceiveAudio===true&&!r){t.addTransceiver("audio")}if(typeof e.offerToReceiveAudio!=="undefined"){e.offerToReceiveVideo=!!e.offerToReceiveVideo}var n=t.getTransceivers().find(function(e){return e.sender.track&&e.sender.track.kind==="video"});if(e.offerToReceiveVideo===false&&n){if(n.direction==="sendrecv"){n.setDirection("sendonly")}else if(n.direction==="recvonly"){n.setDirection("inactive")}}else if(e.offerToReceiveVideo===true&&!n){t.addTransceiver("video")}}return i.apply(t,arguments)}}}},{"../utils":58}],58:[function(e,t,r){"use strict";var n=true;var i=true;function o(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function a(e,n,i){if(!e.RTCPeerConnection){return}var t=e.RTCPeerConnection.prototype;var o=t.addEventListener;t.addEventListener=function(e,t){if(e!==n){return o.apply(this,arguments)}var r=function(e){t(i(e))};this._eventMap=this._eventMap||{};this._eventMap[t]=r;return o.apply(this,[e,r])};var a=t.removeEventListener;t.removeEventListener=function(e,t){if(e!==n||!this._eventMap||!this._eventMap[t]){return a.apply(this,arguments)}var r=this._eventMap[t];delete this._eventMap[t];return a.apply(this,[e,r])};Object.defineProperty(t,"on"+n,{get:function(){return this["_on"+n]},set:function(e){if(this["_on"+n]){this.removeEventListener(n,this["_on"+n]);delete this["_on"+n]}if(e){this.addEventListener(n,this["_on"+n]=e)}}})}t.exports={extractVersion:o,wrapPeerConnectionEvent:a,disableLog:function(e){if(typeof e!=="boolean"){return new Error("Argument type: "+typeof e+". Please use a boolean.")}n=e;return e?"adapter.js logging disabled":"adapter.js logging enabled"},disableWarnings:function(e){if(typeof e!=="boolean"){return new Error("Argument type: "+typeof e+". Please use a boolean.")}i=!e;return"adapter.js deprecation warnings "+(e?"disabled":"enabled")},log:function(){if(typeof window==="object"){if(n){return}if(typeof console!=="undefined"&&typeof console.log==="function"){console.log.apply(console,arguments)}}},deprecated:function(e,t){if(!i){return}console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator;var r={};r.browser=null;r.version=null;if(typeof e==="undefined"||!e.navigator){r.browser="Not a browser.";return r}if(t.mozGetUserMedia){r.browser="firefox";r.version=o(t.userAgent,/Firefox\/(\d+)\./,1)}else if(t.webkitGetUserMedia){r.browser="chrome";r.version=o(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2)}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/)){r.browser="edge";r.version=o(t.userAgent,/Edge\/(\d+).(\d+)$/,2)}else if(e.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./)){r.browser="safari";r.version=o(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else{r.browser="Not a supported browser.";return r}return r}}},{}],59:[function(e,t,r){"use strict";var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i=64,o={},a=0,s=0,c;function f(e){var t="";do{t=n[e%i]+t;e=Math.floor(e/i)}while(e>0);return t}function p(e){var t=0;for(s=0;s<e.length;s++){t=t*i+o[e.charAt(s)]}return t}function u(){var e=f(+new Date);if(e!==c)return a=0,c=e;return e+"."+f(a++)}for(;s<i;s++)o[n[s]]=s;u.encode=f;u.decode=p;t.exports=u},{}],60:[function(e,t,r){t.exports=i;var n=e("socket.io-client");e("webrtc-adapter");function i(e){var r=this;r.apiKey=e;r.socketio=null;r.myId=null;r.myName=null;r.myAvatar=null;r.callAppId=null;r.callAppToken=null;r.qiscuscall=null;t();function t(){r.socketio=n("https://rtc-api.qiscus.com/queue-agent",{forceNew:false,query:{apiKey:r.apiKey}});r.socketio.on("onconnect",function(e){r.myId=e.data.userId;r.myName=e.data.userName;r.myAvatar=e.data.userAvatar;r.onConnect({userId:r.myId,userName:r.myName,userAvatar:r.myAvatar})});r.socketio.on("call",function(e){var t=JSON.parse(e);r.onCall(t.room,{callerId:t.caller.callerId,callerName:t.caller.callerName,callerAvatar:t.caller.callerAvatar})});r.socketio.on("disconnect",function(){r.onDisconnect()})}}i.prototype.setCallCredential=function(e,t){var r=this;r.callAppId=e;r.callAppToken=t};i.prototype.startCall=function(e){var r=this;var n;r.qiscuscall=new QiscusCall(r.callAppId,r.callAppToken);r.qiscuscall.initCall(r.myId,e,false,true);r.qiscuscall.onLocalStream=function(e){r.onCallLocalStream(e)};r.qiscuscall.onRemoteStream=function(e,t){n=e;r.onCallRemoteStream(e,t)};r.qiscuscall.onPeerClosed=function(e){if(e==n){t();r.onCallClosed(e)}};function t(){var e=window.MediaStream;if(typeof e==="undefined"&&typeof webkitMediaStream!=="undefined"){e=webkitMediaStream}if(typeof e!=="undefined"&&!("stop"in e.prototype)){e.prototype.stop=function(){this.getAudioTracks().forEach(function(e){e.stop()});this.getVideoTracks().forEach(function(e){e.stop()})}}}};i.prototype.onConnect=function(e){};i.prototype.onCall=function(e,t){};i.prototype.onCallLocalStream=function(e){};i.prototype.onCallRemoteStream=function(e,t){};i.prototype.onCallClosed=function(e){};i.prototype.onDisconnect=function(){}},{"socket.io-client":34,"webrtc-adapter":48}]},{},[60])(60)});
